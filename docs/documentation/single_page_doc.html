<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>OperatorFabric Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>OperatorFabric Documentation</h1>
<div class="details">
<span id="revnumber">version 1.0.0.RELEASE,</span>
<span id="revdate">09 March 2020</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_operatorfabric_architecture">OperatorFabric Architecture</a>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_business_architecture">2. Business Architecture</a>
<ul class="sectlevel2">
<li><a href="#_business_components">2.1. Business components</a></li>
<li><a href="#_business_objects">2.2. Business objects</a></li>
</ul>
</li>
<li><a href="#_technical_architecture">3. Technical Architecture</a>
<ul class="sectlevel2">
<li><a href="#_business_components_2">3.1. Business components</a></li>
<li><a href="#_technical_components">3.2. Technical components</a>
<ul class="sectlevel3">
<li><a href="#_registry">3.2.1. Registry</a></li>
<li><a href="#_gateway">3.2.2. Gateway</a></li>
<li><a href="#_configuration">3.2.3. Configuration</a></li>
<li><a href="#_broker">3.2.4. Broker</a></li>
<li><a href="#_authentication">3.2.5. Authentication</a></li>
<li><a href="#_database">3.2.6. Database</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_operatorfabric_getting_started">OperatorFabric Getting Started</a>
<ul class="sectlevel1">
<li><a href="#_prerequisites">4. Prerequisites</a></li>
<li><a href="#_install_and_run_server">5. Install and run server</a></li>
<li><a href="#_examples">6. Examples</a>
<ul class="sectlevel2">
<li><a href="#_example_1_send_and_update_a_basic_card">6.1. Example 1 : Send and update a basic card</a>
<ul class="sectlevel3">
<li><a href="#_anatomy_of_the_card">6.1.1. Anatomy of the card :</a></li>
<li><a href="#_update_the_card">6.1.2. Update the card</a></li>
<li><a href="#_delete_the_card">6.1.3. Delete the card</a></li>
</ul>
</li>
<li><a href="#_example_2_publish_a_new_bundle">6.2. Example 2 : Publish a new bundle</a>
<ul class="sectlevel3">
<li><a href="#_package_you_bundle">6.2.1. Package you bundle</a></li>
<li><a href="#_get_a_token">6.2.2. Get a Token</a></li>
<li><a href="#_send_the_bundle">6.2.3. Send the bundle</a></li>
<li><a href="#_send_a_card">6.2.4. Send a card</a></li>
<li><a href="#_internationalization">6.2.5. Internationalization</a></li>
</ul>
</li>
<li><a href="#_example_3_process_with_state">6.3. Example 3 : Process with state</a></li>
<li><a href="#_example_4_time_line">6.4. Example 4 : Time Line</a></li>
</ul>
</li>
<li><a href="#_troubleshooting">7. Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_my_bundle_is_not_loaded">7.1. My bundle is not loaded</a>
<ul class="sectlevel3">
<li><a href="#_solution">7.1.1. Solution</a></li>
</ul>
</li>
<li><a href="#_i_cant_upload_my_bundle">7.2. I can&#8217;t upload my bundle</a>
<ul class="sectlevel3">
<li><a href="#_format_verification">7.2.1. Format verification</a></li>
<li><a href="#_solution_2">7.2.2. Solution</a></li>
</ul>
</li>
<li><a href="#_my_bundle_is_rejected_due_to_internal_structure">7.3. My bundle is rejected due to internal structure</a>
<ul class="sectlevel3">
<li><a href="#_reason">7.3.1. Reason</a></li>
<li><a href="#_solution_3">7.3.2. Solution</a></li>
</ul>
</li>
<li><a href="#_no_template_display">7.4. No template display</a>
<ul class="sectlevel3">
<li><a href="#_verification">7.4.1. Verification</a></li>
<li><a href="#_solution_4">7.4.2. Solution</a></li>
</ul>
</li>
<li><a href="#_my_template_is_not_used">7.5. My template is not used.</a>
<ul class="sectlevel3">
<li><a href="#_solution_5">7.5.1. Solution</a></li>
</ul>
</li>
<li><a href="#_my_value_is_not_displayed_in_the_detail_template">7.6. My value is not displayed in the detail template</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_deployment_and_administration_of_operatorfabric">Deployment and Administration of OperatorFabric</a>
<ul class="sectlevel1">
<li><a href="#_introduction_2">8. Introduction</a></li>
<li><a href="#_deployment">9. Deployment</a></li>
<li><a href="#_rabbitmq">10. RabbitMQ</a>
<ul class="sectlevel2">
<li><a href="#_docker_container">10.1. Docker container</a></li>
<li><a href="#_server_installation">10.2. Server installation</a>
<ul class="sectlevel3">
<li><a href="#_download_installation">10.2.1. Download &amp; Installation</a></li>
<li><a href="#_used_ports">10.2.2. Used ports</a></li>
<li><a href="#_production_configuration">10.2.3. Production configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_configuration_2">11. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_global_configuration">11.1. Global configuration</a></li>
<li><a href="#_operatorfabric_mongo_configuration">11.2. OperatorFabric Mongo configuration</a>
<ul class="sectlevel3">
<li><a href="#_define_time_to_live_for_archived_cards">11.2.1. Define time to live for archived cards</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_specific_configuration">11.3. OperatorFabric Specific configuration</a>
<ul class="sectlevel3">
<li><a href="#_security_configuration">11.3.1. Security Configuration</a></li>
<li><a href="#_user_creation">11.3.2. User creation</a></li>
<li><a href="#_alternative_way_to_manage_groups">11.3.3. Alternative way to manage groups</a></li>
</ul>
</li>
<li><a href="#_service_specific_configuration">11.4. Service-specific configuration</a>
<ul class="sectlevel3">
<li><a href="#_actions_business_service">11.4.1. Actions Business service</a></li>
<li><a href="#_cards_consultation_business_service">11.4.2. Cards-Consultation Business service</a></li>
<li><a href="#_cards_publication_business_service">11.4.3. Cards-Publication Business service</a></li>
<li><a href="#_cloud_gateway_service">11.4.4. Cloud Gateway service</a></li>
<li><a href="#_cloud_configuration_service">11.4.5. Cloud Configuration service</a></li>
<li><a href="#_cloud_registry_service">11.4.6. Cloud Registry service</a></li>
<li><a href="#_thirds_business_service">11.4.7. Thirds Business service</a></li>
<li><a href="#_users_business_service">11.4.8. Users Business service</a></li>
<li><a href="#_web_ui">11.4.9. Web UI</a></li>
</ul>
</li>
<li><a href="#_users_and_groups_administration">11.5. Users and Groups Administration</a>
<ul class="sectlevel3">
<li><a href="#_list_all_users">11.5.1. List all users</a></li>
<li><a href="#_create_a_new_user">11.5.2. Create a new User</a></li>
<li><a href="#_fetch_user_details">11.5.3. Fetch user details</a></li>
<li><a href="#_update_user_details">11.5.4. Update user details</a></li>
<li><a href="#_list_groups">11.5.5. List groups</a></li>
<li><a href="#_create_a_new_group">11.5.6. Create a new Group</a></li>
<li><a href="#_fetch_details_of_a_given_group">11.5.7. Fetch details of a given group</a></li>
<li><a href="#_update_details_of_a_group">11.5.8. Update details of a group</a></li>
<li><a href="#_add_a_user_to_a_group">11.5.9. Add a user to a group</a></li>
<li><a href="#_remove_a_user_from_a_group">11.5.10. Remove a user from a Group</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_service_port_table">12. Service port table</a></li>
<li><a href="#_restricted_operations_administration">13. Restricted operations (administration)</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_community">OperatorFabric Community</a>
<ul class="sectlevel1">
<li><a href="#_introduction_3">14. Introduction</a></li>
<li><a href="#_contributing">15. Contributing</a>
<ul class="sectlevel2">
<li><a href="#_code_of_conduct">15.1. Code of Conduct</a></li>
<li><a href="#_license_and_developer_certificate_of_origin">15.2. License and Developer Certificate of Origin</a></li>
<li><a href="#_how_can_i_contribute">15.3. How Can I Contribute ?</a>
<ul class="sectlevel3">
<li><a href="#_reporting_bugs_and_suggesting_enhancements">15.3.1. Reporting Bugs and Suggesting Enhancements</a></li>
<li><a href="#_contributing_code">15.3.2. Contributing Code</a></li>
</ul>
</li>
<li><a href="#_project_governance">15.4. Project Governance</a>
<ul class="sectlevel3">
<li><a href="#_project_owner">15.4.1. Project Owner</a></li>
<li><a href="#_committers">15.4.2. Committers</a></li>
<li><a href="#_technical_steering_committee">15.4.3. Technical Steering Committee</a></li>
<li><a href="#_contributors">15.4.4. Contributors</a></li>
</ul>
</li>
<li><a href="#_communication_channels">15.5. Communication channels</a>
<ul class="sectlevel3">
<li><a href="#_website_opfab_org">15.5.1. Website: opfab.org</a></li>
<li><a href="#_spectrum_community_spectrum_chatopfab">15.5.2. Spectrum Community : spectrum.chat/opfab</a></li>
<li><a href="#_lf_energy_mailing_lists">15.5.3. LF Energy Mailing Lists</a></li>
<li><a href="#_jira">15.5.4. JIRA</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_contributor_covenant_code_of_conduct">16. Contributor Covenant Code of Conduct</a>
<ul class="sectlevel2">
<li><a href="#_our_pledge">16.1. Our Pledge</a></li>
<li><a href="#_our_standards">16.2. Our Standards</a></li>
<li><a href="#_our_responsibilities">16.3. Our Responsibilities</a></li>
<li><a href="#_scope">16.4. Scope</a></li>
<li><a href="#_enforcement">16.5. Enforcement</a></li>
<li><a href="#_attribution">16.6. Attribution</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_operatorfabric_cicd">OperatorFabric CICD</a>
<ul class="sectlevel1">
<li><a href="#_introduction_4">17. Introduction</a></li>
<li><a href="#_release_process">18. Release process</a>
<ul class="sectlevel2">
<li><a href="#_version_numbers">18.1. Version numbers</a></li>
<li><a href="#_releasing_version">18.2. Releasing Version</a>
<ul class="sectlevel3">
<li><a href="#_in_the_source_repository_operatorfabric_core">18.2.1. In the source repository (operatorfabric-core)</a></li>
<li><a href="#_checking_deploy_docker_compose">18.2.2. Checking deploy docker-compose</a></li>
<li><a href="#_in_the_documentation_repository_opfab_github_io">18.2.3. In the documentation repository (opfab.github.io)</a></li>
<li><a href="#_in_jira">18.2.4. In Jira</a></li>
</ul>
</li>
<li><a href="#_advertising_the_new_release_opfab_github_io_and_mailing_list">18.3. Advertising the new release (opfab.github.io and mailing list)</a></li>
<li><a href="#_preparing_next_version">18.4. Preparing next version</a>
<ul class="sectlevel3">
<li><a href="#_in_the_source_repository_operatorfabric_core_2">18.4.1. In the source repository (operatorfabric-core)</a></li>
<li><a href="#_in_the_documentation_repository_opfab_github_io_2">18.4.2. In the documentation repository (opfab.github.io)</a></li>
<li><a href="#_in_jira_2">18.4.3. In Jira</a></li>
<li><a href="#_checking_dockerhub_the_following_day">18.4.4. Checking DockerHub the following day</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cicd_scripts">19. CICD Scripts</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_release_notes">OperatorFabric Release Notes</a>
<ul class="sectlevel1">
<li><a href="#_version_1_0_0_release">20. Version 1.0.0.RELEASE</a>
<ul class="sectlevel2">
<li><a href="#_story">20.1. Story</a></li>
<li><a href="#_bug">20.2. Bug</a></li>
<li><a href="#_task">20.3. Task</a></li>
<li><a href="#_feature">20.4. Feature</a></li>
</ul>
</li>
<li><a href="#_version_0_15_1_release">21. Version 0.15.1.RELEASE</a>
<ul class="sectlevel2">
<li><a href="#_bug_2">21.1. Bug</a></li>
<li><a href="#_story_2">21.2. Story</a></li>
<li><a href="#_task_2">21.3. Task</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_operatorfabric_architecture" class="sect0">OperatorFabric Architecture</h1>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric is a modular, extensible, industrial-strength and field-tested
platform for use in electricity, water, and other utility operations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System visualization and console integration</p>
</li>
<li>
<p>Precise alerting</p>
</li>
<li>
<p>Workflow scheduling</p>
</li>
<li>
<p>Historian</p>
</li>
<li>
<p>Scripting (ex: Python, JavaScript)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Workflow Scheduling could be addressed either as an internal module or
through simplified and standardized (BPMN) integration with external workflow
engines, we&#8217;re still weighing the pros and cons of the two options._
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is an open source project initiated by <a href="http://www.rte-france.com/">RTE</a>
with <a href="https://www.lfenergy.org/">LF Energy</a>.</p>
</div>
<div class="paragraph">
<p>The aim of this document is to describe the architecture of the solution, first by defining the business concepts it
deals with and then showing how this translates into the technical architecture.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_business_architecture">2. Business Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric is based on the concept of <strong>cards</strong>, which contain data regarding events that are relevant for the
operator.
A third party tool publish cards and the cards are received on the screen of the operators. Depending on the type
of the cards, the operator  can send back information to the third party via an "action".</p>
</div>
<div class="sect2">
<h3 id="_business_components">2.1. Business components</h3>
<div class="imageblock">
<div class="content">
<img src="./images/FunctionalDiagram.jpg" alt="functional diagram">
</div>
</div>
<div class="paragraph">
<p>To do the job, the following business components are defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Card Publication : this component receive the cards from third party tools</p>
</li>
<li>
<p>Card Consultation : this component delivers the cards to the operators and provide access to all cards exchanged (archives)</p>
</li>
<li>
<p>Actions : this component receive the action from the operator and send it to the third party tool</p>
</li>
<li>
<p>Card rendering and process definition : this component store the information for card rendering(templates , internationalization , &#8230;&#8203; ) and a light description of the process associate(states , actions, &#8230;&#8203;) . This configuration data can be provided either by an administrator or by a third party tool.</p>
</li>
<li>
<p>User Management : this component is used to manage users and groups</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_business_objects">2.2. Business objects</h3>
<div class="paragraph">
<p>The business objects can be represented as follow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/BusinessObjects.jpg" alt="business objects diagram">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Card : the core business object which contains the data to show to the user(or operator)</p>
</li>
<li>
<p>Publisher : the third party that publishes cards</p>
</li>
<li>
<p>User : the operator receiving cards and responding via actions</p>
</li>
<li>
<p>Group : a group of users</p>
</li>
<li>
<p>Process : the process the card is dealing with</p>
</li>
<li>
<p>State : the step in the process</p>
</li>
<li>
<p>Card Rendering : data for card rendering</p>
</li>
<li>
<p>Action : a list of possible actions for a specific state in a process</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical_architecture">3. Technical Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The architecture is based on micro-services. All business services are accessible via REST API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/LogicalDiagram.jpg" alt="functional diagram">
</div>
</div>
<div class="sect2">
<h3 id="_business_components_2">3.1. Business components</h3>
<div class="paragraph">
<p>We find here the business component seen before:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We have a "UI" component that store the static pages and the UI code that is downloaded by the browser. The UI is based an <a href="https://angular.io/">Angular</a> and  <a href="https://handlebarsjs.com/">Handlebars</a> for card templating.</p>
</li>
<li>
<p>The business component named  "Card rendering and process definition" is at the technical level known as "Third service". This service receive card rendering and process definition as a bundle. The bundle is a tar.gz file containing</p>
<div class="ulist">
<ul>
<li>
<p>json process configuration file (containings states &amp; actions)</p>
</li>
<li>
<p>templates for rendering</p>
</li>
<li>
<p>stylesheets</p>
</li>
<li>
<p>internationalization information</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All business components are based on <a href="https://spring.io/projects/spring-boot">SpringBoot</a> and packaged via <a href="https://www.docker.com/">Docker</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring WebFlux</a> is used to provide the card in a fluid way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_technical_components">3.2. Technical components</h3>
<div class="sect3">
<h4 id="_registry">3.2.1. Registry</h4>
<div class="paragraph">
<p>It is the central component where all services are registered. It serves as a reference point for the gateway and other
services to find information about the running services instance and allow for local load balancing of accesses. It is implemented by <a href="https://spring.io/projects/spring-cloud-netflix">Spring Cloud Netflix</a> .</p>
</div>
</div>
<div class="sect3">
<h4 id="_gateway">3.2.2. Gateway</h4>
<div class="paragraph">
<p>It provides a filtered view of the APIS and static served pages for external access through browsers or other http
compliant accesses. It provide the rooting and load balancing for accessing the micro-services from outside. It is implemented by <a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/">Spring Cloud Gateway</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">3.2.3. Configuration</h4>
<div class="paragraph">
<p>A configuration service is not mandatory in a micro-services architecture but may allow for better sharing of common configuration and
to dispatch global configuration changes to all services. It is implemented via <a href="https://cloud.spring.io/spring-cloud-config/reference/html/">Spring Cloud Config</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_broker">3.2.4. Broker</h4>
<div class="paragraph">
<p>The broker is used to share information asynchronously across the whole services. It is implemented via <a href="https://www.rabbitmq.com/">RabbitMQ</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_authentication">3.2.5. Authentication</h4>
<div class="paragraph">
<p>The architecture provide a default authentication service via <a href="https://www.keycloak.org/">KeyCloak</a> but it can delegates it to an external provider. Authentication is done through the use of  Oauth2, three flows are supported: implicit, authorization code and password.</p>
</div>
</div>
<div class="sect3">
<h4 id="_database">3.2.6. Database</h4>
<div class="paragraph">
<p>The cards are stored in a <a href="https://www.mongodb.com/">MongoDb</a> database. The bundles are stored in a file system.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_operatorfabric_getting_started" class="sect0">OperatorFabric Getting Started</h1>
<div class="sect1">
<h2 id="_prerequisites">4. Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use OperatorFabric, you need a linux OS with the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker install with 4Gb of space</p>
</li>
<li>
<p>16Gb of RAM minimal ,32 Gb recommended</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_and_run_server">5. Install and run server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To start OperatorFabric, you first need to clone the getting started git</p>
</div>
<div class="listingblock">
<div class="content">
<pre> git clone https://github.com/opfab/operatorfabric-getting-started.git</pre>
</div>
</div>
<div class="paragraph">
<p>Launch the startserver.sh in the server directory. You need to wait for all the services to start (it usually takes one minute to start),it is done when no more logs are written on the output(It could continue to log  but slowly).</p>
</div>
<div class="paragraph">
<p>Test the connection to the UI : To connect to OperatorFabric, open in a browser the following page: <a href="http://localhost:2002/ui/" class="bare">localhost:2002/ui/</a> and use tso1-operator as login and test as password.</p>
</div>
<div class="paragraph">
<p>If you are not accessing the server from localhost, there is a bug with authentication redirection. Your must use the following URL ,replacing SERVER_IP by the IP adress of your server :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://SERVER_IP:89/auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client&amp;redirect_uri=http://SERVER_IP:2002/ui/</pre>
</div>
</div>
<div class="paragraph">
<p>After connection your shoud see the following screen</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/empty-opfab-page.jpg" alt="empty opfab screenshot">
</div>
</div>
<div class="paragraph">
<p>To stop the server , use :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker-compose down &amp;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">6. Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For each example, useful files and scripts are in the directory "client/exampleX".</p>
</div>
<div class="paragraph">
<p>All examples assume you connect to the server from localhost (if not, you will need to change the provided scripts)</p>
</div>
<div class="sect2">
<h3 id="_example_1_send_and_update_a_basic_card">6.1. Example 1 : Send and update a basic card</h3>
<div class="paragraph">
<p>Go in directory "client/example1" and send a card :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:2102/cards -H "Content-type:application/json" --data @card.json</pre>
</div>
</div>
<div class="paragraph">
<p>or use provided script</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 200 Http status and a json object such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"count":1,"message":"All pushedCards were successfully handled"}</pre>
</div>
</div>
<div class="paragraph">
<p>See the result in the UI , you should see a card , if you click on it you&#8217;ll see the detail</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/formated-card-details.jpg" alt="detail card screenshot">
</div>
</div>
<div class="sect3">
<h4 id="_anatomy_of_the_card">6.1.1. Anatomy of the card :</h4>
<div class="paragraph">
<p>A card is containing information regarding the publisher, the recipients , the process , the data to show &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>More information can be found on the user guide : <a href="https://opfab.github.io/documentation/1.0.0.RELEASE/user_guide/#_card_anatomy" class="bare">opfab.github.io/documentation/1.0.0.RELEASE/user_guide/#_card_anatomy</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
	"publisher" : "message-publisher",
	"publisherVersion" : "1",
	"process"  :"defaultProcess",
	"processId" : "hello-world-1",
	"state": "messageState",
	"recipient" : {
				"type" : "GROUP",
				"identity" : "TSO1"
			},
	"severity" : "INFORMATION",
	"startDate" : 1553186770681,
	"summary" : {"key" : "defaultProcess.summary"},
	"title" : {"key" : "defaultProcess.title"},
	"data" : {"message":"Hello World !!! That's my first message"}
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_the_card">6.1.2. Update the card</h4>
<div class="paragraph">
<p>We can send a new version of the card (updateCard.json) :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>change the message , field data.message in the JSON File</p>
</li>
<li>
<p>the severity  , field severity in the JSON File</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
	"publisher" : "message-publisher",
	"publisherVersion" : "1",
	"process"  :"defaultProcess",
	"processId" : "hello-world-1",
	"state": "messageState",
	"recipient" : {
				"type" : "GROUP",
				"identity" : "TSO1"
			},
	"severity" : "ALARM",
	"startDate" : 1553186770681,
	"summary" : {"key" : "defaultProcess.summary"},
	"title" : {"key" : "defaultProcess.title"},
	"data" : {"message":":That's my second message"}
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can send the updated card with :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardUpdate.json</pre>
</div>
</div>
<div class="paragraph">
<p>The card should be updated on the UI.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_the_card">6.1.3. Delete the card</h4>
<div class="paragraph">
<p>You can delete the card using DELETE HTTP code with reference to publisher and processId</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X DELETE http://localhost:2102/cards/message-publisher_hello-world-1 -H "Content-type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or use provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./deleteCard.sh</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_2_publish_a_new_bundle">6.2. Example 2 : Publish a new bundle</h3>
<div class="paragraph">
<p>The way the card is display in the UI is defined via a Bundle containing templates and process description .</p>
</div>
<div class="paragraph">
<p>The bundle is structured as follow :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── css : stylesheets files
├── i18n :   internalization files
└── template :
    ├── en : handlebar templates for detail card rendering
    ├── ....
config.json : process description and global configuration</pre>
</div>
</div>
<div class="paragraph">
<p>The bundle is provided in the bundle directory of example2. It contains a new version of the bundle used in example1 .</p>
</div>
<div class="paragraph">
<p>We just change the template and the stylesheet instead of displaying :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Message :  The message</pre>
</div>
</div>
<div class="paragraph">
<p>we display :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>You received the following message

The message</pre>
</div>
</div>
<div class="paragraph">
<p>If you look at the template file (template/en/template.handlebars):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;h2&gt; You received the following message &lt;/h2&gt;

{{card.data.message}}</pre>
</div>
</div>
<div class="paragraph">
<p>In the stylesheet css/style.css we just change the color value to red (#ff0000):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>h2{
	color:#ff0000;
	font-weight: bold;
}</pre>
</div>
</div>
<div class="paragraph">
<p>The global configuration is defined in config.json :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
	"name":"message-publisher",
	"version":"2",
	"templates":["template"],
	"csses":["style"],
	"processes" : {
		"defaultProcess" : {
			"states":{
				"messageState" : {
					"details" : [{
						"title" : { "key" : "defaultProcess.title"},
						"templateName" : "template",
						"styles" : [ "style.css" ]
					}]
				}
			}
		}
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>To keep the old bundle , we create a new version by setting version to 2.</p>
</div>
<div class="sect3">
<h4 id="_package_you_bundle">6.2.1. Package you bundle</h4>
<div class="paragraph">
<p>Your bundle need to be package in a tar.gz file, a script is available</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./packageBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>A file name bundle.tar.gz will be created.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_token">6.2.2. Get a Token</h4>
<div class="paragraph">
<p>To send the bundle you need to be authentified . To do that you need to get a token with the following commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d "username=admin&amp;password=test&amp;grant_type=password&amp;client_id=opfab-client" http://localhost:2002/auth/token</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./getToken.sh</pre>
</div>
</div>
<div class="paragraph">
<p>You should received JSON a reponse like this :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJSbXFOVTNLN0x4ck5SRmtIVTJxcTZZcTEya1RDaXNtRkw5U2NwbkNPeDBjIn0.eyJqdGkiOiIzZDhlODY3MS1jMDhjLTQ3NDktOTQyOC1hZTdhOTE5OWRmNjIiLCJleHAiOjE1NzU1ODQ0NTYsIm5iZiI6MCwiaWF0IjoxNTc1NTQ4NDU2LCJpc3MiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiYTNhM2IxYTYtMWVlYi00NDI5LWE2OGItNWQ1YWI1YjNhMTI5IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoib3BmYWItY2xpZW50IiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiODc3NzZjOTktYjA1MC00NmQxLTg5YjYtNDljYzIxNTQyMDBhIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJlbWFpbCBwcm9maWxlIiwic3ViIjoiYWRtaW4iLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInByZWZlcnJlZF91c2VybmFtZSI6ImFkbWluIn0.XMLjdOJV-A-iZrtq7sobcvU9XtJVmKKv9Tnv921PjtvJ85CnHP-qXp2hYf5D8TXnn32lILVD3g8F9iXs0otMAbpA9j9Re2QPadwRnGNLIzmD5pLzjJ7c18PWZUVscbaqdP5PfVFA67-j-YmQBwxiys8psF8keJFvmg-ExOGh66lCayClceQaUUdxpeuKFDxOSkFVEJcVxdelFtrEbpoq0KNPtYk7vtoG74zO3KjNGrzLkSE_e4wR6MHVFrZVJwG9cEPd_dLGS-GmkYjB6lorXPyJJ9WYvig56CKDaFry3Vn8AjX_SFSgTB28WkWHYZknTwm9EKeRCsBQlU6MLe4Sng","expires_in":36000,"refresh_expires_in":1800,"refresh_token":"eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIzZjdkZTM0OC05N2Q5LTRiOTUtYjViNi04MjExYTI3YjdlNzYifQ.eyJqdGkiOiJhZDY4ODQ4NS1hZGE0LTQwNWEtYjQ4MS1hNmNkMTM2YWY0YWYiLCJleHAiOjE1NzU1NTAyNTYsIm5iZiI6MCwiaWF0IjoxNTc1NTQ4NDU2LCJpc3MiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJhdWQiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJzdWIiOiJhM2EzYjFhNi0xZWViLTQ0MjktYTY4Yi01ZDVhYjViM2ExMjkiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoib3BmYWItY2xpZW50IiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiODc3NzZjOTktYjA1MC00NmQxLTg5YjYtNDljYzIxNTQyMDBhIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6ImVtYWlsIHByb2ZpbGUifQ.sHskPtatqlU9Z8Sfq6yvzUP_L6y-Rv26oPpykyPgzmk","token_type":"bearer","not-before-policy":0,"session_state":"87776c99-b050-46d1-89b6-49cc2154200a","scope":"email profile"}</pre>
</div>
</div>
<div class="paragraph">
<p>Your token is the access_token value in the JSON. The token will be valid for 10 hours , after you will need to ask for a new one.</p>
</div>
</div>
<div class="sect3">
<h4 id="_send_the_bundle">6.2.3. Send the bundle</h4>
<div class="paragraph">
<p>Replace the value "THE TOKEN" with the token in the sendBundle.sh script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>token=THE TOKEN
curl -s -X POST "http://localhost:2100/thirds" -H  "accept: application/json" -H  "Content-Type: multipart/form-data" -H "Authorization:Bearer $token" -F "file=@bundle.tar.gz;type=application/gzip"</pre>
</div>
</div>
<div class="paragraph">
<p>You can now execute the script, it will send the bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>You should received the following JSON in response , describing your bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"name":"message-publisher","version":"2","templates":["template"],"csses":["style"],"i18nLabelKey":null,"processes":{"defaultProcess":{"statesData":{"messageState":{"detailsData":[{"title":{"key":"defaultProcess.title","parameters":null},"titleStyle":null,"templateName":"template","styles":null}],"actionsData":null,"details":[{"title":{"key":"defaultProcess.title","parameters":null},"titleStyle":null,"templateName":"template","styles":null}],"actions":null}},"states":{"messageState":{"detailsData":[{"title":{"key":"defaultProcess.title","parameters":null},"titleStyle":null,"templateName":"template","styles":null}],"actionsData":null,"details":[{"title":{"key":"defaultProcess.title","parameters":null},"titleStyle":null,"templateName":"template","styles":null}],"actions":null}}}},"medias":null,"menuEntries":null}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_send_a_card">6.2.4. Send a card</h4>
<div class="paragraph">
<p>You can send the following card to test your new bundle :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
	"publisher" : "message-publisher",
	"publisherVersion" : "2",
	"process"  :"defaultProcess",
	"processId" : "hello-world-1",
	"state": "messageState",
	"recipient" : {
				"type" : "GROUP",
				"identity" : "TSO1"
			},
	"severity" : "INFORMATION",
	"startDate" : 1553186770681,
	"summary" : {"key" : "defaultProcess.summary"},
	"title" : {"key" : "defaultProcess.title"},
	"data" : {"message":"Hello world in new version"}
}</pre>
</div>
</div>
<div class="paragraph">
<p>To use the new bundle , we set publisherVersion to "2"</p>
</div>
<div class="paragraph">
<p>To send the card :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh</pre>
</div>
</div>
<div class="paragraph">
<p>You should see in the UI the detail card with the new template.</p>
</div>
</div>
<div class="sect3">
<h4 id="_internationalization">6.2.5. Internationalization</h4>
<div class="paragraph">
<p>If you switch langage to french in the UI (Settings menu on the top rigth of the screen), you should see the cards in french.</p>
</div>
<div class="paragraph">
<p>OperatorFabric will use templates define in repository "template/fr" and keys define in "i18n/fr.json".</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_3_process_with_state">6.3. Example 3 : Process with state</h3>
<div class="paragraph">
<p>For this example , we will set the following process :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1 : A critical situation arise on the HightVoltage grid</p>
</li>
<li>
<p>Step 2 : The critical situation evolve</p>
</li>
<li>
<p>Step 3 : The critical situation ended</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To modelise this process in OperatorFabric, we will use a "Process" with "States"  , we will modelize this in the config.json of the bundle :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "name":"alert-publisher",
  "version":"1",
  "templates":["criticalSituationTemplate","endCriticalSituationTemplate"],
  "csses":["style"],
  "processes" : {
    "criticalSituation" : {
	  "states":{
		"criticalSituation-begin" : {
		  "details" : [{
		    "title" : { "key" : "criticalSituation-begin.title"},
			  "templateName" : "criticalSituationTemplate",
			  "styles" : [ "style.css" ]
			}]
		},
		"criticalSituation-update" : {
		  "details" : [{
		    "title" : { "key" : "criticalSituation-update.title"},
			  "templateName" : "criticalSituationTemplate",
			  "styles" : [ "style.css" ]
			}]
		},
		"criticalSituation-end" : {
		  "details" : [{
		    "title" : { "key" : "criticalSituation-end.title"},
			"templateName" : "endCriticalSituationTemplate",
			"styles" : [ "style.css" ]
		  }]
		}
	  }
	}
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can see in the JSON we define a process name "criticalSituation" with 3 states : criticalSituation-begin , criticalSituation-update and criticalSituation-end . For each state we define a title for the card and the template an stylesheets to use .</p>
</div>
<div class="paragraph">
<p>The title is a key which refer to a i18n found in the coresponding i18n respository :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
	"criticalSituation-begin":{
		"title":"CRITICAL SITUATION",
		"summary":" CRITICAL SITUATION ON THE GRID , SEE DETAIL FOR INSTRUCTION"
	},
        "criticalSituation-update":{
                "title":"CRITICAL SITUATION - UPDATE",
                "summary":" CRITICAL SITUATION ON THE GRID , SEE DETAIL FOR INSTRUCTION"
        },
        "criticalSituation-end":{
                "title":"CRITICAL SITUATION - END",
                "summary":" CRITICAL SITUATION ENDED"
	}

}</pre>
</div>
</div>
<div class="paragraph">
<p>The templates can be found in the template directory.</p>
</div>
<div class="paragraph">
<p>We can now send cards and simulate the process, first we send a card at the beginning of the critical situation :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
	"publisher" : "alert-publisher",
	"publisherVersion" : "1",
	"process"  :"criticalSituation",
	"processId" : "alert1",
	"state": "criticalSituation-begin",
	"recipient" : {
				"type" : "GROUP",
				"identity" : "TSO1"
			},
	"severity" : "ALARM",
	"startDate" : 1553186770681,
	"summary" : {"key" : "criticalSituation-begin.summary"},
	"title" : {"key" : "criticalSituation-begin.title"},
	"data" : {"instruction":"Critical situation on the grid : stop immediatly all maintenance on the grid"}
}</pre>
</div>
</div>
<div class="paragraph">
<p>The card refer to the process "criticalSituation" as defined in the config.json, the state attribute is put to "criticalSituation-begin" which is the first step of the process, again as defined in the config.json. The card can be send via provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>Two other card have be provided to continu the process</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cardUpdate.json : the state is criticalSituation-update</p>
</li>
<li>
<p>cardEnd.json : the state is criticalSituation-end and severity set to "information"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can send these cards :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardUpdate.json</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardEnd.json</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_4_time_line">6.4. Example 4 : Time Line</h3>
<div class="paragraph">
<p>To view the card in the time line , you need to set times in the card using timeSpans attributes as in the following card :</p>
</div>
<div class="listingblock">
<div class="content">
<pre> {
	"publisher" : "scheduledMaintenance-publisher",
	"publisherVersion" : "1",
	"process"  :"maintenanceProcess",
	"processId" : "maintenance-1",
	"state": "planned",
	"recipient" : {
				"type" : "GROUP",
				"identity" : "TSO1"
			},
	"severity" : "INFORMATION",
	"startDate" : 1553186770681,
	"summary" : {"key" : "maintenanceProcess.summary"},
	"title" : {"key" : "maintenanceProcess.title"},
	"data" : {
		"operationDescription":"Maintenance operation on the International France England (IFA) Hight Voltage line ",
		"operationResponsible":"RTE",
		"contactPoint":"By Phone : +33 1 23 45 67 89 ",
		"comment":"Operation has no impact on service"
		},
	"timeSpans" : [
        {"start" : 1576080876779},
        {"start" : 1576104912066}
    	]
}</pre>
</div>
</div>
<div class="paragraph">
<p>For this example, we use a new publisher called "scheduledMaintenance-publisher". You won&#8217;t need to post the
corresponding bundle to the thirds service as it has been loaded in advance to be available out of the box (only for the
getting started). If you want to take a look at its content you can find it under
server/thirds-storage/scheduledMaintenance-publisher/1.</p>
</div>
<div class="paragraph">
<p>Before sending the card provide , you need to set the good time values as epoch (ms)  (<a href="https://en.wikipedia.org/wiki/Epoch_(computing)" class="bare">en.wikipedia.org/wiki/Epoch_(computing)</a>) in the json . For each value you set , you will have a point in the timeline . In our example , the first point represent the beginning of the maintenance operation and the second the end of the maintenance operation.</p>
</div>
<div class="paragraph">
<p>To get the dates in epoch , you can use the following  commandes</p>
</div>
<div class="paragraph">
<p>For the first date:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date -d "+ 600 minutes" +%s%N | cut -b1-13</pre>
</div>
</div>
<div class="paragraph">
<p>And for the second</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date -d "+ 900 minutes" +%s%N | cut -b1-13</pre>
</div>
</div>
<div class="paragraph">
<p>To send the card use the provided script in example4 directory</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>A second card (card2.json) is provided as example, you need again to set times values in the json file and then send it</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card2.json</pre>
</div>
</div>
<div class="paragraph">
<p>This time the criticity of the card is ALERT, you should see the point in red in the timeline</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/example4.jpg" alt="example 4 screenshot">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">7. Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_my_bundle_is_not_loaded">7.1. My bundle is not loaded</h3>
<div class="paragraph">
<p>The server send a <code>{"status":"BAD_REQUEST","message":"unable to open submitted
file","errors":["Error detected parsing the header"]}</code>, despite correct http
headers.</p>
</div>
<div class="paragraph">
<p>The uploaded bundle is corrupted. Test your bundle in a terminal (Linux
solution).</p>
</div>
<div class="paragraph">
<p>Example for a bundle archive named <code>MyBundleToTest.tar.gz</code> giving the
mentioned error when uploaded :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tar -tzf MyBundleToTest.tar.gz &gt;/dev/null
tar: This does not look like a tar archive
tar: Skipping to next header
tar: Exiting with failure status due to previous errors</pre>
</div>
</div>
<div class="sect3">
<h4 id="_solution">7.1.1. Solution</h4>
<div class="paragraph">
<p>Extract content if possible and compress it to a correct compressed archive
format.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_i_cant_upload_my_bundle">7.2. I can&#8217;t upload my bundle</h3>
<div class="paragraph">
<p>The server responds with a message like the following:
<code>{"status":"BAD_REQUEST","message":"unable to open submitted
file","errors":["Input is not in the .gz format"]}</code></p>
</div>
<div class="paragraph">
<p>The bundle has been compressed using an unmanaged format.</p>
</div>
<div class="sect3">
<h4 id="_format_verification">7.2.1. Format verification</h4>
<div class="sect4">
<h5 id="_linux_solution">Linux solution</h5>
<div class="paragraph">
<p>Command line example to verify the format of a bundle archive named
<code>MyBundleToTest.tar.gz</code>(which gives the mentioned error when uploaded):</p>
</div>
<div class="literalblock">
<div class="content">
<pre> tar -tzf MyBundleToTest.tar.gz &gt;/dev/null</pre>
</div>
</div>
<div class="paragraph">
<p>which should return in such case the following messages:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_solution_2">7.2.2. Solution</h4>
<div class="paragraph">
<p>Use <code>tar.gz</code> format for the archive compression. Shell command is <code>tar -czvf
MyBundleToTest.tar.gz config.json template/ css/</code> for a bundle containing
templates and css files.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_bundle_is_rejected_due_to_internal_structure">7.3. My bundle is rejected due to internal structure</h3>
<div class="paragraph">
<p>The server sends <code>{"status":"BAD_REQUEST","message":"Incorrect inner file
structure","errors":["$OPERATOR_FABRIC_INSTANCE_PATH/d91ba68c-de6b-4635-a8e8-b58
fff77dfd2/config.json (Aucun fichier ou dossier de ce type)"]}</code></p>
</div>
<div class="paragraph">
<p>Where <code>$OPERATOR_FABRIC_INSTANCE_PATH</code> is the folder where thirds files are
stored server side.</p>
</div>
<div class="sect3">
<h4 id="_reason">7.3.1. Reason</h4>
<div class="paragraph">
<p>The internal file structure of your bundle is incorrect. <code>config.json</code> file and
folders need to be at the first level.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_3">7.3.2. Solution</h4>
<div class="paragraph">
<p>Add or organize the files and folders of the bundle to fit the Third bundle
requirements.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_no_template_display">7.4. No template display</h3>
<div class="paragraph">
<p>The server send 404 for requested template with a response like
<code>{"status":"NOT_FOUND","message":"The specified resource does not
exist","errors":["$OPERATOR_FABRIC_INSTANCE_PATH/thirds-storage/BUNDLE_TEST/1/te
mplate/fr/template1.handlebars (Aucun fichier ou dossier de ce type)"]}</code></p>
</div>
<div class="sect3">
<h4 id="_verification">7.4.1. Verification</h4>
<div class="paragraph">
<p>The previous server response is return for a request like:
<code>http://localhost:2002/thirds/BUNDLE_TEST/templates/template1?locale=fr&amp;version
=1</code></p>
</div>
<div class="paragraph">
<p>The bundle is lacking localized folder and doesn&#8217;t contain the requested
localization.</p>
</div>
<div class="paragraph">
<p>If you have access to the <code>card-publication</code> micro service source code you
should list the content of
<code>$CARDS_PUBLICATION_PROJECT/build/docker-volume/third-storage</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_4">7.4.2. Solution</h4>
<div class="paragraph">
<p>Either request another l10n or add the requested one to the bundle and
re-upload it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_template_is_not_used">7.5. My template is not used.</h3>
<div class="paragraph">
<p>It need to be declared in the config.json of the bundle.</p>
</div>
<div class="sect3">
<h4 id="_solution_5">7.5.1. Solution</h4>
<div class="paragraph">
<p>Add or verify the name of the templates declared in the <code>config.json</code> file of
the bundle.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_value_is_not_displayed_in_the_detail_template">7.6. My value is not displayed in the detail template</h3>
<div class="paragraph">
<p>There are several possibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the path of the data used in the template is incorrect;</p>
</li>
<li>
<p>number of pair of <code>{</code> and <code>}</code> has to follow those rules:</p>
<div class="ulist">
<ul>
<li>
<p>with no helper the good number is only 2 pairs;</p>
</li>
<li>
<p>with OperatorFabric helpers it&#8217;s 3 pairs of them.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_deployment_and_administration_of_operatorfabric" class="sect0">Deployment and Administration of OperatorFabric</h1>
<div class="sect1">
<h2 id="_introduction_2">8. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The aim of this document is to explain how to configure and deploy OperatorFabric.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deployment">9. Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For now OperatorFabric consist of Docker images available either by compiling
the project or by using images releases from <a href="https://hub.docker.com/">Dockerhub</a></p>
</div>
<div class="paragraph">
<p>Service images are all based on <a href="https://hub.docker.com/_/openjdk">openjdk:8-jdk-alpine</a>.</p>
</div>
<div class="paragraph">
<p>For simple one instance per service deployment, you can find a sample
deployment as a docker-compose file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/docker/deploy">here</a></p>
</div>
<div class="paragraph">
<p>To run OperatorFabric in development mode, see <a href="../dev_env/index.html">the development environment documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rabbitmq">10. RabbitMQ</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_docker_container">10.1. Docker container</h3>
<div class="paragraph">
<p>In development mode, the simplest way to deploy a RabbitMQ server is to
create a RabbitMQ docker container. A <a href="src/main/docker/rabbitmq">docker-compose file</a> is provided to allow quick setup of a convenient RabbitMQ
 server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_server_installation">10.2. Server installation</h3>
<div class="paragraph">
<p>This section is dedicated to production deployment of RabbitMQ. It is
 not complete and needs to be tailored to any specific production
 environment.</p>
</div>
<div class="sect3">
<h4 id="_download_installation">10.2.1. Download &amp; Installation</h4>
<div class="paragraph">
<p>Download and install RabbitMQ following the
<a href="https://www.rabbitmq.com/download.html">official procedure</a> for the
target environment</p>
</div>
</div>
<div class="sect3">
<h4 id="_used_ports">10.2.2. Used ports</h4>
<div class="paragraph">
<p>If RabbitMQ may not bind to the following ports, it won&#8217;t start :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>4369</strong>: epmd, a peer discovery service used by RabbitMQ nodes and
CLI tools</p>
</li>
<li>
<p><strong>5672, 5671</strong>: used by AMQP 0-9-1 and 1.0 clients without and with
TLS</p>
</li>
<li>
<p><strong>25672</strong>: used for inter-node and CLI tools communication
(Erlang distribution server port) and is allocated from a dynamic range
(limited to a single port by default, computed as AMQP port + 20000).
Unless external connections on these ports are really necessary
(e.g. the cluster uses federation or CLI tools are used on machines
outside the subnet), these ports should not be publicly exposed. See
networking guide for details.</p>
</li>
<li>
<p><strong>35672-35682</strong>: used by CLI tools (Erlang distribution client ports)
for communication with nodes and is allocated from a dynamic range
(computed as server distribution port + 10000 through server
distribution port + 10010). See networking guide for details.</p>
</li>
<li>
<p><strong>15672</strong>: HTTP API clients, management UI and rabbitmqadmin (<strong>only if
the management plugin is enabled</strong>)</p>
</li>
<li>
<p><strong>61613, 61614</strong>: STOMP clients without and with TLS
(<strong>only if the STOMP plugin is enabled</strong>)</p>
</li>
<li>
<p><strong>1883, 8883</strong>: (MQTT clients without and with TLS,
<em>if the MQTT plugin is enabled</em>)</p>
</li>
<li>
<p><strong>15674</strong>: STOMP-over-WebSockets clients
(<strong>only if the Web STOMP plugin is enabled</strong>)</p>
</li>
<li>
<p><strong>15675</strong>: MQTT-over-WebSockets clients
(<strong>only if the Web MQTT plugin is enabled</strong>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_production_configuration">10.2.3. Production configuration</h4>
<div class="paragraph">
<p>See the <a href="https://www.rabbitmq.com/production-checklist.html">guide</a> for
production configuration guidelines</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_2">11. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric has multiple services to configure. These configurations are managed by a Configuration Service, of which
they can be several instances to ensure availability.</p>
</div>
<div class="paragraph">
<p>See <a href="https://opfab.github.io/documentation/1.0.0.RELEASE/architecture/">OperatorFabric Architecture</a> for more information
on the different services.</p>
</div>
<div class="paragraph">
<p>All services are SpringBoot applications and use jetty as an embedded servlet container. As such, they share some common
configuration which is described in the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Springboot documentation</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config">Springboot external configuration</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#common-application-properties">Common application properties from Springboot documentation</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_global_configuration">11.1. Global configuration</h3>
<div class="paragraph">
<p>Aside from the one for the configuration service, all configurations are gathered as resources in the
configuration service (under /services/infra/config/src/main/docker/volume).</p>
</div>
<div class="paragraph">
<p>Note that a few things cannot be set in the configuration served by the configuration service (because its needed
right at the application startup for example) and
must be set in each services bootstrap configuration file. In this regard,
<a href="#_cloud_configuration_service">Cloud Configuration service</a>[Configuration] and <a href="#_cloud_registry_service">Cloud Registry service</a>[Registry]
services have specific configuration but for other services, they all require
the same minimal information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mandatory</strong> service name(spring.application.name)</p>
</li>
<li>
<p><strong>mandatory</strong> configuration name (spring.cloud.config.name)</p>
</li>
<li>
<p><strong>mandatory</strong> configuration fetch from registry enabled (spring.cloud.config.discovery.enabled: true)</p>
</li>
<li>
<p><strong>mandatory</strong> configuration service name in registry (spring.cloud.config.discovery.service-id)</p>
</li>
<li>
<p><strong>mandatory</strong> eureka registration (eureka.client.register-with-eureka: true and
eureka.client.fetch-registry: true)</p>
</li>
<li>
<p><strong>mandatory</strong> eureka registry urls (eureka.client.service-url.defaultZone)</p>
</li>
<li>
<p>configuration fail fast (spring.cloud.config.fail-fast)</p>
</li>
<li>
<p>configuration fetch maximum retry (spring.cloud.config.retry.max-attempts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most situation, you do not need to change the default bootstrap
configuration for those services. Make a copy of the default bootstrap (inside
the jar or from the sources) and set eureka up (see above).</p>
</div>
<div class="paragraph">
<p>The different services also share common configuration you can setup in the
config service backend. those common configuration may be set up in the backend <code><code>application.yml</code></code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  rabbitmq:
    host: rabbitmq
    port: 5672
    username: guest
    password: guest
  data:
    mongodb:
      uris:
        - mongodb://root:password@mongodb:27017/operator-fabric?authSource=admin&amp;authMode=scram-sha1
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://authserver/auth/realms/dev/protocol/openid-connect/certs
eureka:
  client:
    service-url:
      defaultZone: http://registry:8080/eureka
    region: default
  registryFetchIntervalSeconds: 5

operatorfabric:
  security:
    oauth2:
      client-id: opfab-client
      client-secret: opfab-oauth-secret
    jwt:
      login-claim: preferred_username
      expire-claim: exp</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example you can see that we need to configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ (See <a href="https://docs.spring.io/spring-amqp/docs/2.1.3.RELEASE/reference/htmlsingle//reference/htmlsingle/">spring-amqp doc</a>)</p>
</li>
<li>
<p>MongoDB</p>
</li>
<li>
<p>Eureka (See <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.1.0.RC3//single/spring-cloud-netflix.html#_service_discovery_eureka_clients">spring eureka</a>)</p>
</li>
<li>
<p>OperatorFabric</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_mongo_configuration">11.2. OperatorFabric Mongo configuration</h3>
<div class="paragraph">
<p>We only use URI configuration for mongo through the usage of the <code><code>spring.data.mongodb.uris</code></code>,
it allows us to share the same configuration behavior for simple or cluster
configuration and with both spring classic and reactive mongo configuration.
See <a href="https://docs.mongodb.com/manual/reference//connection-string/">mongo connection string</a> for the complete URI syntax.</p>
</div>
<div class="sect3">
<h4 id="_define_time_to_live_for_archived_cards">11.2.1. Define time to live for archived cards</h4>
<div class="paragraph">
<p>By default, archived cards will remain stored in the database forever. It is possible to have them automatically
removed after a specified duration by using the <a href="https://docs.mongodb.com/manual/core/index-ttl/">TTL index feature of mongoDB</a> on their publishDate field.</p>
</div>
<div class="paragraph">
<p>For example, to have cards expire after 10 days (864000s), enter the following commands in the mongo shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">use operator-fabric
db.archivedCards.createIndex( { "publishDate": 1 }, { expireAfterSeconds: 864000 } )</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You cannot use createIndex() to change the value of expireAfterSeconds of an existing index.
Instead use the <a href="https://docs.mongodb.com/manual/reference/command/collMod/#dbcmd.collMod">collMod</a> database command in conjunction with the index collection flag. Otherwise, to
change the value of the option of an existing index, you must drop the index first and recreate.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_specific_configuration">11.3. OperatorFabric Specific configuration</h3>
<div class="paragraph">
<p>Below are description of OperatorFabric specific configuration properties.</p>
</div>
<div class="paragraph">
<p>Note that other components may have specific configuration, see the relevant
sub-sections.</p>
</div>
<div class="sect3">
<h4 id="_security_configuration">11.3.1. Security Configuration</h4>
<div class="sect4">
<h5 id="_common_configuration">Common configuration</h5>
<div class="paragraph">
<p>This concern is configured within the <code>${OF_HOME}/services/infra/config</code> project
into 3 distinct files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>application.yml</code>;</p>
</li>
<li>
<p><code>web-ui.yml</code>;</p>
</li>
<li>
<p><code>client-gateway.yml</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They are located into the following folders within the <code>${OF_HOME}/services/infra/config/java/src/main/docker/volume</code> folder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dev-configurations</code>: to be use into <code>dev</code> mode;</p>
</li>
<li>
<p><code>docker-configurations</code>: used by docker at run time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>EXAMPLE: the configuration for <code>dev</code> before compilation is done in the following files:
    - <code>${OF_HOME}/services/infra/config/java/src/main/docker/volume/dev-configurations/application.yml</code>;
    - <code>${OF_HOME}/services/infra/config/java/src/main/docker/volume/dev-configurations/client-gateway.ym</code>;
    - <code>${OF_HOME}/services/infra/config/java/src/main/docker/volume/dev-configurations/web-ui.yml</code>.</p>
</div>
<div class="paragraph">
<p>For test purposes in <code>dev</code> mode, it&#8217;s possible to edit files located into <code>`${OF_HOME}/services/infra/config/build/docker-volume/dev-configurations</code>.
Be aware that those changes will be lost after a new compilation or even a simple re-run of the project.</p>
</div>
<div class="paragraph">
<p>This configuration files follow the <code>springframework</code> configuration convention. Within a same file it&#8217;s possible to
use <code><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions">SpEL ${}</a></code> convention. For example,  <code>${AnotheProperty}</code> allows to re-use the value of <code>AnotherProperty</code> already declared.
It helps to avoid typos or missing to report some changes. An example could be find below into the <code>delegate-url</code> property.</p>
</div>
<div class="sect5">
<h6 id="_application_yml">application.yml</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oauth2 client id used by OperatorFabric may be specific for each service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oauth2 client secret used by OperatorFabric may be specific for each service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.login-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used as user login or id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.expire-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used as token expiration timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.oauth2.resourceserver.jwt.provider-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keycloak instance url</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.oauth2.resourceserver.jwt.provider-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The realm name within the keycloak instance</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>example of <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric:
    security:
        oauth2:
            client-id: opfab-client
            client-secret: opfab-keycloak-secret
        jwt:
            login-claim: preferred_username
            expire-claim: exp</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>operatorfabric.security.jwt.expire-claim</code> could have been omitted because having the same value as the default one.</p>
</div>
</div>
<div class="sect5">
<h6 id="_client_gateway_yml">client-gateway.yml</h6>
<div class="paragraph">
<p>In a configuration service <code>client-gateway.yml</code> file</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application must set up a route to the oauth server</p>
<div class="ulist">
<ul>
<li>
<p><code>/auth/token(?&lt;path&gt;.*)</code>: must match the oauth2 token entry point;</p>
</li>
<li>
<p><code>/auth/code/(?&lt;params&gt;.*)</code>: must match the auth entry point with specific query
parameters like <code>response_type=code&amp;client_id=[client id]&amp;${params}</code>;</p>
</li>
<li>
<p><code>/auth/check_token</code>: must match token introspection entry point</p>
</li>
</ul>
</div>
</li>
<li>
<p>The application must add request header for each request:</p>
<div class="ulist">
<ul>
<li>
<p><code>AddRequestHeader: Authorization, Basic</code>: followed, separated with a space, by the <code>OAuth2 client-id</code> and the <code>OAuth2 client-secret</code> encoded in base64.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The application may set up CORS rules if api are to be accessed from browser outside of
the deployment domain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration example of the filters, for the docker dev keycloak:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring.cloud.gateway.routes[0].filters:
        - RewritePath=/auth/token(?&lt;path&gt;.*), /auth/realms/dev/protocol/openid-connect/token$\{path}
        - RewritePath=/auth/code/(?&lt;params&gt;.*), /auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client&amp;$\{params}
        - RewritePath=/auth/check_token, /auth/realms/dev/protocol/openid-connect/token/introspect
        - AddRequestHeader=Authorization, Basic b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:
- <code>spring.cloud.gateway.routes.uri</code>: is your keycloak instance
- <code>spring.cloud.gateway.routes[0]</code> is the routes with <code>id</code> equals to <code>auth</code>;
- <code>/realms/dev</code>: is the keycloak realm where <code>opfab-client</code> is defined.
- <code>b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==</code>: is the base64 encoded string of <code>opfab-client:opfab-keycloak-secret</code> with
<code>opfab-client</code> as client-id and <code>opfab-keycloak-secret</code> its client secret.</p>
</div>
</div>
<div class="sect5">
<h6 id="_web_ui_yml">web-ui.yml</h6>
<div class="paragraph">
<p>For OAuth2 security concerns into this file, there are two way to configure it, based on the Oauth2 chosen flow.
There are two common properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>operatorfabric.security.oauth2.flow.provider</code> which corresponds to the OAuth2 provider.</p>
</li>
<li>
<p><code>operatorfabric.security.realm-url</code>: which is the OAuth2 realm provider under which the OpertaroFabric client is declared.</p>
</li>
<li>
<p><code>operatorfabric.security.provider-url</code>: which is the The keycloak server instance.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_oauth2_flows_and_specific_configuration">OAuth2 Flows and specific configuration</h5>
<div class="paragraph">
<p>There are 3 OAuth2 Authentication flows available into OperatorFabric UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>password grant: referred as PASSWORD mode flow;</p>
</li>
<li>
<p>code flow : referred as  CODE mode flow;</p>
</li>
<li>
<p>implicit flow: referred as IMPLICIT mode flow.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_oauth2_implicit_flow">OAuth2 IMPLICIT Flow</h6>
<div class="paragraph">
<p>It had its own way of configuration.
To enable IMPLICIT Flow authentication the following properties need to be set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>operatorfabric.security.oauth2.flow.mode</code> to <code>IMPLICIT</code>;</p>
</li>
<li>
<p><code>operatorfabric.security.oauth2.flow.delegate-url</code> with the URL of the OAuth2 leading to the <code>.well-known/openid-configuration</code> end-point used for authentication configuration.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_example_of_keycloak_configuration_for_operatorfabric_oauth2">Example of Keycloak configuration for OperatorFabric OAuth2</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric:
  keycloak:
    realm: dev
  security:
    oauth2:
      flow:
        mode: IMPLICIT
        provider: Opfab Keycloak
        delagate-url: http://localhost:89/auth/realms/${operatorfabric.keycloak.realm}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the <code>delegate-url</code> property the <code>${operatorfabric.keycloak.realm}</code> refers to the value of the <code>operatorfabric.keycloak.realm</code> declared earlier, <code>dev</code> here.
For keycloak instance used for dev purposes, this <code>delegate-url</code> correspond to the realm under which the client <code>opfab-client</code> is registred. The
url look up by the implicit ui mechanism is <code><a href="http://localhost:89/auth/realms/dev/.well-known/openid-configuration" class="bare">localhost:89/auth/realms/dev/.well-known/openid-configuration</a></code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_keycloak_instance_additional_configuration_for_dev_purposes">Keycloak instance additional configuration for dev purposes</h7>
<div class="paragraph">
<p>Once connected as Admin (login:_admin_,password:_admin_ ) on keycloak (<code><a href="http://localhost:89/auth/admin" class="bare">localhost:89/auth/admin</a></code>) The first thing is to enable the implicit flow for <code>opfa-client</code>. To do so
select <code>Dev</code> in the upper select of the right panel then click on Clients. In the table, click on <code>opfab-client</code> in the column <code>Client ID</code>. Then in the <code>Settings</code> tabs turn on the
<code>Implicit Flow Enabled</code>. In the same tab, modify <code><a href="http://localhost:2002/ui/" class="bare">localhost:2002/ui/</a></code> to <code><a href="http://localhost:2002/" class="bare">localhost:2002/</a><strong></code> and <code><a href="http://localhost:4200" class="bare">localhost:4200</a></code> to <code><a href="http://localhost:4200/" class="bare">localhost:4200/</a></strong></code>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_oauth2_password_or_code_flows">OAuth2 PASSWORD or CODE Flows</h6>
<div class="paragraph">
<p>These two modes share the same way of declaring the delegate URL. The default configuration for dev is set to <code>CODE</code> and work straight away.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>operatorfabric.security.oauth2.flow.mode</code> to <code>PASSWORD</code> or <code>CODE</code>;</p>
</li>
<li>
<p><code>operatorfabric.security.oauth2.flow.delegate-url</code> with the URL of the OAuth2 leading to the protocol used for authentication.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_example_of_keycloak_configuration_for_operatorfabric_oauth2_2">Example of Keycloak Configuration For OperatorFabric OAuth2</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric:
  keycloak:
    realm: dev
  security:
    oauth2:
      flow:
        mode: CODE
        provider: Opfab Keycloak
        delagate-url: http://localhost:89/auth/realms/${operatorfabric.keycloak.realm}/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the <code>delegate-url</code> property the <code>${operatorfabric.keycloak.realm}</code> refers to the value(also <code>dev</code> here) of the <code>operatorfabric.keycloak.realm</code> declared earlier.
Here, the <code>client-id</code> value is <code>opfab-client</code> which is define as client under the <code>realm</code> named dev on the dev keycloak instance.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_token">Using token</h5>
<div class="sect5">
<h6 id="_get_a_token_2">Get a token</h6>
<div class="paragraph">
<p>End point: <code><a href="http://localhost:2002/auth/token" class="bare">localhost:2002/auth/token</a></code></p>
</div>
<div class="paragraph">
<p>Method: <code>POST</code></p>
</div>
<div class="paragraph">
<p>Body arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>client_id: <code>string</code> constant=<code>clientIdPassword</code>;</p>
</li>
<li>
<p>grant_type: <code>string</code> constant=<code>password</code>;</p>
</li>
<li>
<p>username: <code>string</code> any value, must match an OperatorFabric registered user
name;</p>
</li>
<li>
<p>password: <code>string</code> any value;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following examples will be for <code>admin</code> user.</p>
</div>
<div class="sect6">
<h7 id="_curl">Curl</h7>
<div class="paragraph">
<p>command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -s -X POST -d
"username=admin&amp;password=test&amp;grant_type=password&amp;client_id=clientIdPassword"
http://localhost:2002/auth/token</pre>
</div>
</div>
<div class="paragraph">
<p>example of expected result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cC
I6MTU1MjY1OTczOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOi
IwMmQ4MmU4NS0xM2YwLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZF
Bhc3N3b3JkIiwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0
rWVtFGAZzRHj7KPgaOXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdK
VAz0CkMKqng4kQeQm_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVD
SJew1rj5EiSybuy83PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZC
AYVM-mmHbjk8mF89fL9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw","to
ken_type":"bearer","refresh_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWI
iOiJhZG1pbiIsInNjb3BlIjpbInJlYWQiLCJ1c2VyX2luZm8iXSwiYXRpIjoiMDJkODJlODUtMTNmMC0
0Njc4LTk3NGQtMThlYjA2MjE1YTY1IiwiZXhwIjoxNTUyNzAxMTM4LCJhdXRob3JpdGllcyI6WyJST0x
FX0FETUlOIiwiUk9MRV9VU0VSIl0sImp0aSI6IjMwOWY2ZDllLWNmOGEtNDg0YS05ZjMxLWViOTAxYzk
4YTFkYSIsImNsaWVudF9pZCI6ImNsaWVudElkUGFzc3dvcmQifQ.jnZDt6TX2BvlmdT5JV-A7eHTJz_s
lC5fHrJFVI58ly6N7AUUfxebG_52pmuVHYULSKqTJXaLR866r-EnD4BJlzhk476FtgtVx1nazTpLFRLb
8qDCxeLrzClQBkzcxOt6VPxB3CD9QImx3bcsDwjkPxofUDmdg8AxZfGTu0PNbvO8TKLXEkeCztLFvSJM
GlN9zDzWhKxr49I-zPZg0XecgE9j4WITkFoDVwI-AfDJ3sGXDi5AN55Sz1j633QoqVjhtc0lO50WPVk5
YT7gU8HLj27EfX-6vjnGfNb8oeq189-NX100QHZM9Wgm79mIm4sRgwhpv-zzdDAkeb3uwIpb8g","exp
ires_in":1799,"scope":"read
user_info","jti":"02d82e85-13f0-4678-974d-18eb06215a65"}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_httpie">Httpie</h7>
<div class="literalblock">
<div class="content">
<pre>http --form POST http://localhost:2002/auth/token username=admin password=test
grant_type=password client_id=clientIdPassword</pre>
</div>
</div>
<div class="paragraph">
<p>example of expected result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.HTTP/1.1 200 OK
Cache-Control: no-store
Content-Type: application/json;charset=utf-8
Date: Fri, 15 Mar 2019 13:57:19 GMT
Pragma: no-cache
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
transfer-encoding: chunked

{
    "access_token":
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2MDAzOS
wiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliMS03Yz
g3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2
NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2qFa5Bd
3PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lHDd8ST
8fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNXJ4Bge
8scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeApKdfD
J6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q",
    "expires_in": 1799,
    "jti": "624309b1-7c87-4cdc-8443-0124515f87f8",
    "refresh_token":
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsInNjb3BlIjpbInJlYWQiLC
J1c2VyX2luZm8iXSwiYXRpIjoiNjI0MzA5YjEtN2M4Ny00Y2RjLTg0NDMtMDEyNDUxNWY4N2Y4IiwiZX
hwIjoxNTUyNzAxNDM5LCJhdXRob3JpdGllcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImp0aS
I6ImRiYzMxNTJiLTM4YTUtNGFmZC1hY2VmLWVkZTI4MjJkOTE3YyIsImNsaWVudF9pZCI6ImNsaWVudE
lkUGFzc3dvcmQifQ.Ezd8kbfNQHOOvUCNNN4UmOOkncHiT9QVEM63FiW1rq0uXDa3xfBGil8geM5MsP0
7Q2He-mynkFb8sGNDrAXTdO-8r5o4a60zWrktrMg2QH4icC1lyeZpiwZxe6675QpLpSeMlXt9PdYj-pb
14lrRookxXP5xMQuIMteZpbtby7LuuNAbNrjveZ1bZ4WMi7zltUzcYUuqHlP1AYPteGRrJVKXiuPpoDv
gwMsEk2SkgyyACI7SdZZs8IT9IGgSsIjjgTMQKzj8P6yYxNLUynEW4o5y1s2aAOV0xKrzkln9PchH9zN
qO-fkjTVRjy_LBXGq9zkn0ZeQ3BUe1GuthvGjaA",
    "scope": "read user_info",
    "token_type": "bearer"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_extract_token">Extract token</h6>
<div class="paragraph">
<p>From the previous results, the data need to be considered to be authenticated
by OperatorFabric services is the content of the <code>"access_token"</code> attribute of
the body response.</p>
</div>
<div class="paragraph">
<p>Once this value extracted, it need to be passed at the end of the value of the
http HEADER of type <code>Authorization:Bearer</code>.
example from previous results:</p>
</div>
<div class="sect6">
<h7 id="_curl_2">Curl</h7>
<div class="literalblock">
<div class="content">
<pre>Authorization:Bearer
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY1OTczOCw
iYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiIwMmQ4MmU4NS0xM2Y
wLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2N
vcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0rWVtFGAZzRHj7KPga
OXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdKVAz0CkMKqng4kQeQm
_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVDSJew1rj5EiSybuy83
PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZCAYVM-mmHbjk8mF89f
L9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_httpie_2">Httpie</h7>
<div class="literalblock">
<div class="content">
<pre>Authorization:Bearer
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2MDAzOSw
iYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliMS03Yzg
3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2N
vcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2qFa5Bd3
PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lHDd8ST8
fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNXJ4Bge8
scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeApKdfDJ
6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_check_a_token">Check a token</h6>
<div class="sect6">
<h7 id="_curl_3">Curl</h7>
<div class="paragraph">
<p>from previous example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -s -X POST -d
"token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY1
OTczOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiIwMmQ4MmU4
NS0xM2YwLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3Jk
Iiwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0rWVtFGAZzR
Hj7KPgaOXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdKVAz0CkMKqn
g4kQeQm_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVDSJew1rj5Ei
Sybuy83PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZCAYVM-mmHbj
k8mF89fL9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw"
http://localhost:2002/auth/check_token</pre>
</div>
</div>
<div class="paragraph">
<p>which gives the following example of result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "sub":"admin",
    "scope":["read","user_info"],
    "active":true,"exp":1552659738,
    "authorities":["ROLE_ADMIN","ROLE_USER"],
    "jti":"02d82e85-13f0-4678-974d-18eb06215a65",
    "client_id":"clientIdPassword"
}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_httpie_3">Httpie</h7>
<div class="paragraph">
<p>from previous example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http --form POST http://localhost:2002/auth/check_token
token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2M
DAzOSwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliM
S03Yzg3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkI
iwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2q
Fa5Bd3PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lH
Dd8ST8fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNX
J4Bge8scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeA
pKdfDJ6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q</pre>
</div>
</div>
<div class="paragraph">
<p>which gives the following example of result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Content-Type: application/json;charset=utf-8
Date: Fri, 15 Mar 2019 14:19:31 GMT
Expires: 0
Pragma: no-cache
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
transfer-encoding: chunked

{
    "active": true,
    "authorities": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ],
    "client_id": "clientIdPassword",
    "exp": 1552660039,
    "jti": "624309b1-7c87-4cdc-8443-0124515f87f8",
    "scope": [
        "read",
        "user_info"
    ],
    "sub": "admin"
}</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_creation">11.3.2. User creation</h4>
<div class="paragraph">
<p>Setting automated user creation==. Creation user requires an user id. Given name and family name are optional.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.login-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used as an user login or id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.given-name-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">given-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used to set the user&#8217;s given name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.family-name-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">family-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used to set the user&#8217;s family name</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_alternative_way_to_manage_groups">11.3.3. Alternative way to manage groups</h4>
<div class="paragraph">
<p>By default, <code>Operator-Fabric</code> manage groups through the user&#8217;s group. Another mode can be defined, the JWT mode. The groups come from the authentication token. The administrator of the authentication service has to set what claims define a group. In the <code>Operator-Fabric</code> configuration, the opfab administrator has to set properties to retrieve thoses groups.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPERATOR_FABRIC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the group mode, possible values JWT or OPERATOR_FABRIC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandard-claim.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines a group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardArray.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines an array of groups</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardList.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines a list of group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardList.separator</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the separator value of the list of group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimCheckExistPath.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to check if that path does exist, if it does, use the roleValue as a group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimCheckExistPath.roleValue</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the value of the group if the path exists</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>application.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric:
  security:
    jwt:
      groups:
        mode: JWT # value possible JWT | OPERATOR_FABRIC
        rolesClaim:
          rolesClaimStandard:
            - path: "ATTR1"
            - path: "ATTR2"
          rolesClaimStandardArray:
            - path: "resource_access/opfab-client/roles"
          rolesClaimStandardList:
            - path: "roleFieldList"
              separator: ";"
          rolesClaimCheckExistPath:
            - path: "resource_access/AAA"
              roleValue: "roleAAA"
            - path: "resource_access/BBB"
              roleValue: "roleBBB"</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>JWT example</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
  "jti": "5ff87583-10bd-4946-8753-9d58171c8b7f",
  "exp": 1572979628,
  "nbf": 0,
  "iat": 1572961628,
  "iss": "http://localhost:89/auth/realms/dev",
  "aud": [
    "AAA",
    "BBB",
    "account"
  ],
  "sub": "example_user",
  "typ": "Bearer",
  "azp": "opfab-client",
  "auth_time": 0,
  "session_state": "960cbec4-fcb2-47f2-a155-975832e61300",
  "acr": "1",
  "realm_access": {
    "roles": [
      "offline_access",
      "uma_authorization"
    ]
  },
  "resource_access": {
    "AAA": {
      "roles": [
        "role_AAA"
      ]
    },
    "BBB": {
      "roles": [
        "role_BBB"
      ]
    },
    "opfab-client": {
      "roles": [
        "USER"
      ]
    },
    "account": {
      "roles": [
        "manage-account",
        "manage-account-links",
        "view-profile"
      ]
    }
  },
  "scope": "openid ATTR2 email ATTR1 profile roleFieldList",
  "email_verified": false,
  "name": "example_firtstname example_lastname",
  "ATTR2": "roleATTR2",
  "ATTR1": "roleATTR1",
  "preferred_username": "example_user",
  "given_name": "example_firtstname",
  "family_name": "example_lastname",
  "email": "example_user@mail.com",
  "roleFieldList": "roleA;roleB;roleC"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the result, the group will be [ATTR1, ATTR2, roleA, roleB, roleC, USER, roleBBB, roleAAA]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_specific_configuration">11.4. Service-specific configuration</h3>
<div class="sect3">
<h4 id="_actions_business_service">11.4.1. Actions Business service</h4>
<div class="paragraph">
<p>OperatorFabric Actions Business service is a Spring Webflux application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web-reactive.html#webflux">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties">Service specific properties</h6>

</div>
<div class="sect5">
<h6 id="_default_properties">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: actions
  cloud:
    config:
      name: actions
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: actions
  cloud:
    config:
      name: actions
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: actions
  cloud:
    config:
      name: actions
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
logging.level.root: debug
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_development_configuration">Sample development configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2105</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_launching_a_jar_file">Specifying external configuration properties when launching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_a_docker_image">Specifying configuration properties when launching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runActions.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_on_kubernetes">Specifying configuration properties when launching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cards_consultation_business_service">11.4.2. Cards-Consultation Business service</h4>
<div class="paragraph">
<p>OperatorFabric Cards-Consultation Business service is a Spring Webflux application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_2">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web-reactive.html#webflux">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_2">Service specific properties</h6>

</div>
<div class="sect5">
<h6 id="_default_properties_2">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-consultation
  cloud:
    config:
      name: cards-consultation
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-consultation
  cloud:
    config:
      name: cards-consultation
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-consultation
  cloud:
    config:
      name: cards-consultation
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_development_configuration_2">Sample development configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2104
logging.level.root: DEBUG</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_2">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_launching_a_jar_file_2">Specifying external configuration properties when launching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_a_docker_image_2">Specifying configuration properties when launching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runCards-Consultation.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_2">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_on_kubernetes_2">Specifying configuration properties when launching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_2">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cards_publication_business_service">11.4.3. Cards-Publication Business service</h4>
<div class="paragraph">
<p>OperatorFabric Cards-Publication Business service is a Spring Webflux application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_3">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web-reactive.html#webflux">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_3">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.card-write.window.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card input window size to fill before flush</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.card-write.window.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card input window millis wait time before flush</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.card-notification.window.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card notification window size to fill before flush</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.card-notification.window.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card notification window millis wait time before flush</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_3">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-publication
  cloud:
    config:
      name: cards-publication
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-publication
  cloud:
    config:
      name: cards-publication
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: cards-publication
  cloud:
    config:
      name: cards-publication
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_development_configuration_3">Sample development configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2102</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_3">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_launching_a_jar_file_3">Specifying external configuration properties when launching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_a_docker_image_3">Specifying configuration properties when launching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runCards-Publication.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_3">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_on_kubernetes_3">Specifying configuration properties when launching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_3">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_gateway_service">11.4.4. Cloud Gateway service</h4>
<div class="paragraph">
<p>OperatorFabric Client Gateway service is a Spring Cloud Gateway application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture the gateway service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_4">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>To get a working gateway service, there a few mandatory configuration
properties:</p>
</div>
<div class="paragraph">
<p>In a configuration service <code>client-gateway.yml</code> file</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application must set up a route to the oauth server</p>
<div class="ulist">
<ul>
<li>
<p><code>/auth/token(?&lt;path&gt;.*)</code>: must match the oauth2 token entry point;</p>
</li>
<li>
<p><code>/auth/code/(?&lt;params&gt;.*)</code>: must match the auth entry point with specific query
parameters like <code>response_type=code&amp;client_id=[client id]&amp;${params}</code>;</p>
</li>
<li>
<p><code>/auth/check_token</code>: must match token introspection entry point</p>
</li>
</ul>
</div>
</li>
<li>
<p>The application must add request header for each request:</p>
<div class="ulist">
<ul>
<li>
<p><code>AddRequestHeader: Authorization, Basic</code>: followed, separated with a space, by the <code>OAuth2 client-id</code> and the <code>OAuth2 client-secret</code> encoded in base64.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The application may set up CORS rules if api are to be accessed from browser outside of
the deployment domain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration example of the filters, for the docker dev keycloak:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring.cloud.gateway.routes[0].filters:
        - RewritePath=/auth/token(?&lt;path&gt;.*), /auth/realms/dev/protocol/openid-connect/token$\{path}
        - RewritePath=/auth/code/(?&lt;params&gt;.*), /auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client&amp;$\{params}
        - RewritePath=/auth/check_token, /auth/realms/dev/protocol/openid-connect/token/introspect
        - AddRequestHeader=Authorization, Basic b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:
- <code>spring.cloud.gateway.routes.uri</code>: is your keycloak instance
- <code>spring.cloud.gateway.routes[0]</code> is the routes with <code>id</code> equals to <code>auth</code>;
- <code>/realms/dev</code>: is the keycloak realm where <code>opfab-client</code> is defined.
- <code>b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==</code>: is the base64 encoded string of <code>opfab-client:opfab-keycloak-secret</code> with
<code>opfab-client</code> as client-id and <code>opfab-keycloak-secret</code> its client secret.</p>
</div>
<div class="paragraph">
<p>For other configuration see <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html">spring cloud gateway documentation</a>.</p>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_4">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.gateway.configs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an array of string for each allowed config entries</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_4">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: client-gateway
  cloud:
    config:
      name: client-gateway
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: client-gateway
  cloud:
    config:
      name: client-gateway
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: client-gateway
  cloud:
    config:
      name: client-gateway
      failFast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: 'http://localhost:2001/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_developpement_configuration">Sample developpement configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2002
spring:
  cloud:
    gateway:
      routes:
      - id: auth
        uri: http://localhost:89
        predicates:
        - Path=/auth/**
        filters:
        - RewritePath=/auth/token(?&lt;path&gt;.*), /auth/realms/dev/protocol/openid-connect/token$\{path}
        - RewritePath=/auth/code/(?&lt;params&gt;.*), /auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client&amp;$\{params}
        - RewritePath=/auth/check_token, /auth/realms/dev/protocol/openid-connect/token/introspect
        - AddRequestHeader=Authorization, Basic b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==
# WARNING : THIS CORS CONFIGURATION SHOULD NOT BE USED IN PRODUCTION
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "Authorization, Content-Type"
operatorfabric.gateway.configs:
  - web-ui.json
#logging.level.root: debug</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_4">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  cloud:
    gateway:
      routes:
      - id: auth
        uri: http://keycloak:8080
        predicates:
        - Path=/auth/**
        filters:
        - RewritePath=/auth/token(?&lt;path&gt;.*), /auth/realms/dev/protocol/openid-connect/token$\{path}
        - RewritePath=/auth/code/(?&lt;params&gt;.*), /auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client&amp;$\{params}
        - RewritePath=/auth/check_token, /auth/realms/dev/protocol/openid-connect/token/introspect
        - AddRequestHeader=Authorization, Basic b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==
# WARNING : THIS CORS CONFIGURATION SHOULD NOT BE USED IN PRODUCTION
        globalcors:
         corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "Authorization, Content-Type"
operatorfabric.gateway.configs:
  - web-ui.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writting, you cannot specify an alternate profile at runtime.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_4">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_4">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_configuration_service">11.4.5. Cloud Configuration service</h4>
<div class="paragraph">
<p>OperatorFabric Configuration service is a Spring Cloud Config application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture Configuration instances are the first
services to bootstrap, thus they are configured in a specific way contrary to
other services.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_5">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>To get a working configuration service, there a few mandatory configuration
properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in a bootstrap file:</p>
<div class="ulist">
<ul>
<li>
<p>The application must have a set name (spring.application.name)</p>
</li>
</ul>
</div>
</li>
<li>
<p>in an application property file</p>
<div class="ulist">
<ul>
<li>
<p>The application must have a configured rabbitmq service for configuration
change notification (spring.rabbitmq.*)</p>
</li>
<li>
<p>The application must have a configured eureka server (eureka.client.*)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For other configuration see <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.1.0.RELEASE/single/spring-cloud-config.html">spring cloud config documentation</a>.</p>
</div>
<div class="paragraph">
<p>Note that it is mandatory to define an environment repository for the service.
Dev and Docker profile uses a file system backend which is not suitable for
production and redundancy. You should prefer the usage of Git or Vault for
production.</p>
</div>
<div class="sect5">
<h6 id="_default_properties_5">default properties</h6>
<div class="paragraph">
<p>It is preferable not to change the following bootstrap.yml file.</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: config</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>application.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>management:
  endpoints:
    web:
      exposure:
        include: '*'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:
* it sets its name as a service (config)
* it exposes management endpoints</p>
</div>
</div>
<div class="sect5">
<h6 id="_dev_profile">dev profile</h6>
<div class="paragraph">
<p>dev is the profile we use internally for developpement we make it available for
external developers so that they don&#8217;t need extensive configuration to get a
jar working in the development environment</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2000
spring:
#  level.root: debug
  profiles:
    active: [native,dev]
  cloud:
    config:
      server:
        native:
          search-locations:
           - file:./build/dev-data/dev-configurations
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
eureka:
  client:
    region: default
    service-url:
      defaultZone: http://localhost:2001/eureka
    registryFetchIntervalSeconds: 5</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>it exposes the service on port 2000 (defaults to 8080)</p>
</li>
<li>
<p>it activates the dev and native profile (native is mandatory for serving
config from file system)</p>
</li>
<li>
<p>it configures rabbitmq for dispatching config change messages to other services</p>
</li>
<li>
<p>it configures registration in eureka discovery service</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_docker_profile">docker profile</h6>
<div class="paragraph">
<p>docker is the profile we use in our docker images</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  profiles:
    active: [native]
  cloud:
    config:
      server:
        native:
          search-locations:
           - file:/service-config
  rabbitmq:
    host: ${RABBITMQ_HOST}
    port: ${RABBITMQ_PORT}
    username: ${RABBITMQ_USER}
    password: ${RABBITMQ_PASSWORD}
eureka:
  client:
    region: default
    service-url:
      defaultZone: http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka
    registryFetchIntervalSeconds: 5</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>it activates the native profile (native is mandatory for serving
config from file system)</p>
</li>
<li>
<p>it configures rabbitmq for dispatching config change messages to other services</p>
</li>
<li>
<p>it configures registration in eureka discovery service</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_2">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>Seehttps://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles[Set the Active Spring Profiles] for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_2">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writting, you cannot specify an alternate profile at runtime.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_5">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>RABBITMQ_HOST: Rabbitmq host name</p>
</li>
<li>
<p>RABBITMQ_PORT: Rabbitmq host port</p>
</li>
<li>
<p>RABBITMQ_USER: Rabbitmq user name used for authentication service</p>
</li>
<li>
<p>RABBITMQ_PASSWORD: Rabbitmq user password used for authentication service</p>
</li>
<li>
<p>REGISTRY_HOST: Registry (eureka) host name</p>
</li>
<li>
<p>REGISTRY_PORT: Registry (eureka) host port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_2">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_5">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>RABBITMQ_HOST: Rabbitmq host name</p>
</li>
<li>
<p>RABBITMQ_PORT: Rabbitmq host port</p>
</li>
<li>
<p>RABBITMQ_USER: Rabbitmq user name used for authentication service</p>
</li>
<li>
<p>RABBITMQ_PASSWORD: Rabbitmq user password used for authentication service</p>
</li>
<li>
<p>REGISTRY_HOST: Registry (eureka) host name</p>
</li>
<li>
<p>REGISTRY_PORT: Registry (eureka) host port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_registry_service">11.4.6. Cloud Registry service</h4>
<div class="paragraph">
<p>OperatorFabric Registry service is a Spring Eureka application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture Eureka Registry instances are the second
services to bootstrap, its configuration relies on the <a href="#_cloud_configuration_service">Cloud Configuration service</a>.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_6">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>To get a working registry service, there a few mandatory configuration
properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a bootstrap file</p>
<div class="ulist">
<ul>
<li>
<p>The application must have a set name (spring.application.name)</p>
</li>
<li>
<p>The application must have a set configuration name (spring.cloud.config.name)</p>
</li>
<li>
<p>The application must have a set configuration server (spring.cloud.config.uri)</p>
</li>
<li>
<p>The application may have a retry/failfast configuration for config access
(spring.cloud.config.failfast, spring.cloud.config.retry)</p>
</li>
</ul>
</div>
</li>
<li>
<p>In a configuration service registry.yml file</p>
<div class="ulist">
<ul>
<li>
<p>The application may deactivate eureka registration to avoid self registration
(deactivated by default in internal application.yml file)</p>
</li>
<li>
<p>The application must set the Eureka instance hostname (eureka.instance.hostname)</p>
</li>
<li>
<p>The application must set the Eureka default zone (eureka.lient.serviceUrl.defaultZone)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For other configuration see <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.1.0.RC3/single/spring-cloud-netflix.html">spring cloud netflix documentation</a>.</p>
</div>
<div class="sect5">
<h6 id="_default_properties_6">default properties</h6>
<div class="paragraph">
<p>It is preferable not to change the following bootstrap.yml file.</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: registry
  cloud.config:
    name: registry
    fail-fast: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: registry
  cloud.config:
    name: registry
    uri: http://${CONFIG_HOST}:${CONFIG_PORT}
    failFast: true
    retry:
      maxAttempts: 50</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: registry
  cloud.config:
    name: registry
    uri: http://localhost:2000</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>application.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>eureka:
  client:
    register-with-eureka: false
    fetch-registry: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
developpement environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:
* it sets its name as a service (config)
* it sets the configuration name to use (which configuration file to retrieve)
* it must set the configuration service (example in bootstrap-docker.yml)</p>
</div>
</div>
<div class="sect5">
<h6 id="_dev_profile_2">dev profile</h6>
<div class="paragraph">
<p>dev is the profile we use internally for developpement we make it available for
external developers so that they don&#8217;t need extensive configuration to get a
jar working in the development environment</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2001
eureka:
  instance.hostname: localhost
  client.serviceUrl.defaultZone: http://localhost:2001/eureka/</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_development_configuration_4">Sample development configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2001
eureka:
  instance.hostname: localhost
  client.serviceUrl.defaultZone: http://localhost:2001/eureka/</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_5">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>eureka:
  instance.hostname: registry
  client:
    serviceUrl.defaultZone: http://registry:8080/eureka/
    registerWithEureka: false
    fetchRegistry: false
    server:
      waitTimeInMsWhenSyncEmpty: 0</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_3">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_3">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writting, you cannot specify an alternate profile at runtime.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_6">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>CONFIG_HOST: Configuration service host</p>
</li>
<li>
<p>CONFIG_PORT: Configuration service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_3">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_6">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>CONFIG_HOST: Configuration service host</p>
</li>
<li>
<p>CONFIG_PORT: Configuration service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_thirds_business_service">11.4.7. Thirds Business service</h4>
<div class="paragraph">
<p>OperatorFabric Thirds Business service is a Spring MVC application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_7">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web.html#mvc">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_5">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.thirds.storage.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File path to data storage folder</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_7">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: thirds
  cloud:
    config:
      name: thirds
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: thirds
  cloud:
    config:
      name: thirds
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: thirds
  cloud:
    config:
      name: thirds
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_development_configuration_5">Sample development configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2100
operatorfabric.thirds:
  storage:
    path: "./services/core/thirds/build/docker-volume/thirds-storage"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_6">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric.thirds:
  storage:
    path: "/thirds-storage"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_launching_a_jar_file_4">Specifying external configuration properties when launching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_a_docker_image_4">Specifying configuration properties when launching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runThirds.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_7">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_on_kubernetes_4">Specifying configuration properties when launching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_7">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_users_business_service">11.4.8. Users Business service</h4>
<div class="paragraph">
<p>OperatorFabric Users Business service is a Spring MVC application
bootstrapped using SpringBoot.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_8">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web.html#mvc">Spring MVC documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_6">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of user objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.user-settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of user settings objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of group objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_8">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: users
  cloud:
    config:
      name: users
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: users
  cloud:
    config:
      name: users
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: users
  cloud:
    config:
      name: users
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_development_configuration_6">Sample development configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2103
operatorfabric.users.default:
  users:
    - login: admin
      groups: ["ADMIN"]
    - login: rte-operator
      groups: ["RTE","ADMIN","TRANS"]
    - login: tso1-operator
      groups: ["TSO1","TRANS"]
    - login: tso2-operator
      groups: ["TSO2", "TRANS"]
  groups:
    - name: ADMIN
      description: The admin group
    - name: RTE
      description: RTE TSO Group
    - name: TSO1
      description: TSO 1 Group
    - name: TSO2
      description: TSO 2 Group
    - name: TRANS
      description: Transnationnal Group
  user-settings:
    - login: rte-operator
      description: Da Operator Rulez
#logging.level.root: DEBUG</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_7">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>operatorfabric.users.default:
  users:
  - login: admin
    groups: ["ADMIN"]
  - login: rte-operator
    groups: ["RTE","ADMIN","TRANS"]
  - login: tso1-operator
    groups: ["TSO1","TRANS"]
  - login: tso2-operator
    groups: ["TSO2", "TRANS"]
  groups:
  - name: ADMIN
    description: The admin group
  - name: RTE
    description: RTE TSO Group
  - name: TSO1
    description: TSO 1 Group
  - name: TSO2
    description: TSO 2 Group
  - name: TRANS
    description: Transnationnal Group</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_launching_a_jar_file_5">Specifying external configuration properties when launching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_a_docker_image_5">Specifying configuration properties when launching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runUsers.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_8">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_launching_on_kubernetes_5">Specifying configuration properties when launching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_8">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_web_ui">11.4.9. Web UI</h4>
<div class="paragraph">
<p>OperatorFabric Web UI service is a Spring MVC application bootstrapped using
SpringBoot. Its sole purpose is to serve the Angular SPA to browsers.</p>
</div>
<div class="paragraph">
<p>In our spring micro service architecture this service depends on Eureka
Registry.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_configuration_profiles_and_default_properties_9">Mandatory configuration, Profiles and default properties</h5>
<div class="paragraph">
<p>The service has no mandatory configuration beside global configuration and
usual bootstrap configuration.</p>
</div>
<div class="paragraph">
<p>For other configuration see:
NONE
* <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Spring Boot documentation</a>.
* <a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web-reactive.html#webflux">Spring MVC documentation</a>.</p>
</div>
<div class="sect5">
<h6 id="_service_specific_properties_7">Service specific properties</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.realm-url</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The realm name in keycloak server settings page. This is used for the log out process to know which realm should be affected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.provider-url</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keycloak server instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.logout-url</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The keycloak logout URL. Is a composition of:
 - Your keycloak instance and the <em>auth</em> keyword (ex: <a href="https://www.keycloakurl.com/auth" class="bare">www.keycloakurl.com/auth</a>), but we also support domains without <em>auth</em> (ex: <a href="https://www.keycloakurl.com/customPath" class="bare">www.keycloakurl.com/customPath</a>)
 - The realm name (Ex: dev)
 - The redirect URL (<em>redirect_uri</em>): The redirect URL after success authentification</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.flow.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>authentication mode, awailable options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CODE: Authorization Code Flow;</p>
</li>
<li>
<p>PASSWORD: Direct Password Flow (fallback);</p>
</li>
<li>
<p>IMPLICIT: Implicit Flow.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.flow.provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider name to display on log in button</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.flow.delegate-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Url to redirect the browser to for authentication. Mandatory with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CODE flow: must be the url with protocol choice and version as query parameters;</p>
</li>
<li>
<p>IMPLICIT flow: must be the url part before <code>.well-known/openid-configuration</code> (for example in dev configuration it&#8217;s
<code><a href="http://localhost:89/auth/realms/dev" class="bare">localhost:89/auth/realms/dev</a></code>).</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.subscription.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Milliseconds between card subscription renewal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.card.time.display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUSINESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>card time display mode in the feed. Values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BUSINESS: displays card with entire business period. It the fallback if the set value is none of the values listed here;</p>
</li>
<li>
<p>BUSINESS_START: displays card with business start date;</p>
</li>
<li>
<p>PUBLICATION: displays card with publication date;</p>
</li>
<li>
<p>LTTD: displays card with lttd date;</p>
</li>
<li>
<p>NONE: nothing displayed.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.timeline.hide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the time line is not loaded in the feed screen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.timeFilter.followClockTick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the time filter on the feed will shift
to reflect elapsed time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.feed.notify</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, new cards are notified in the OS through web-push notifications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.i18n.supported.locales</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of supported locales (Only fr and en so far)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.i10n.supported.time-zones</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of supported time zones, for instance 'Europe/Paris'.
Values should be taken from the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">TZ database</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.navbar.thirdmenus.type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BOTH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines how thirdparty menu links are displayed in the navigation bar and how
they open. Possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TAB: Only a text link is displayed, and clicking it opens the link in a new tab.</p>
</li>
<li>
<p>IFRAME: Only a text link is displayed, and clicking it opens the link in an iframe in the main content zone below
the navigation bar.</p>
</li>
<li>
<p>BOTH: Both a text link and a little arrow icon are displayed. Clicking the text link opens the link in an iframe
while clicking the icon opens in a new tab.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.time.pulse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration between two ticks of the internal state of the User Interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.archive.filters.page.size</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page size of archive filters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.archive.filters.page.first</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first page start of archiving module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.archive.filters.process.list</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of processes to choose from in the corresponding filter in archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.archive.filters.tags.list</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of tags to choose from in the corresponding filter in archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.tags.hide</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the tags filter in settings and feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.disable</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to disable/enable editing user email, description in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the user email in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the user description in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the language in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.timezone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the timezone in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.timeformat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the timeformat in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.dateformat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the dateformat in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.datetimeformat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the datetimeformat in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.infos.tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the tags in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.about</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>operatorfabric:<br>
     name:  'OperatorFabric'<br>
     version:  ${currentVersion}<br>
     rank: 0</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>no</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Declares application names and their version into web-ui about section.<br>
Each entry is
a free key value followed by its name (a string of characters), its version(a string of characters) and its rank of declaration(a number) cf the default value where the declared key is <code>operatorfabric'</code>.<br>
For this default value, with <code>'OperatorFabric'</code> as <code>name</code> and <code>0</code> as <code>rank</code>, the value of <code>${currentVersion}</code> is the version of the current release. <code>0.16.1-RELEASE</code> for example.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logo.base64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">medium OperatorFabric icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The encoding result of converting the svg logo to Base64, use this <a href="https://base64.guru/converter/encode/image/svg">online tool</a> to encode your svg. If it is not set, a medium (32px) OperatorFabric icon is displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logo.height</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The height of the logo (in px) (only taken into account if operatorfabric.logo.base64 is set).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logo.width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">150</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The width of the logo (in px) (only taken into account if operatorfabric.logo.base64 is set).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logo.limitSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If it is true, the height limit is 32(px) and the width limit is 200(px), it means that if the height is over than 32, it will be set to 32, if the width is over than 200, it is set to 200. If it is false, no limit restriction for the height and the width.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OperatorFabric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Title of the application, displayed on the browser</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>User Settings default values</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mandatory?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeZone</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user time zone for users (use</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user time format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.dateFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user date format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.dateTimeFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LL LT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user date format (moment)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">en</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user locale (use en if not set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.default-tags</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user list of filtered in tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateInsideTooltipsWeek</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateInsideTooltipsWeek</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ddd DD MMM HH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on date inside tooltips for time&#8217;s unit lower than hour</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateInsideTooltipsMonth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ddd DD MMM YYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on date inside tooltips for other case</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnDay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ddd DD MMM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display a day and month informations with day name, number, and month</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnWeek</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DD/MM/YY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display a week information with day number, month number and two last year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnMonth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MMM YY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display a month information with month name and two last year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">YYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display a year information</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.titleDateInsideTooltips</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DD/MM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on first part of title inside tooltips showing day number and month number of its date</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.titleHourInsideTooltips</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HH:mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on second part of title inside tooltips showing hours and minutes of its date</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateOnDayNewYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DD MMM YY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use for display first year&#8217;s day on a day configuration display day number, month name and two last year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.realTimeBarFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DD/MM/YY HH:mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on real time bar date, show minutes, hours, day number, month number and two last year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateSimplifliedOnDayNewYear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D MMM YY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on date configuration for first year&#8217;s day, show simplified day number, month name and last two year&#8217;s number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.dateSimplifliedOnDay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D MMM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format use on date configuration, show simplified day number and month name</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.hoursOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format for show only hours</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.minutesOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format for show only minutes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.secondedsOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ss</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format for show only seconds</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.settings.timeLineDefaultClusteringFormats.weekNumberOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ww</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format for show only week number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_default_properties_9">default properties</h6>
<div class="paragraph">
<p>Note that you must provide a bootstrap file with a convenient registry configuration</p>
</div>
<div class="paragraph">
<p><em>bootstrap.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: web-ui
  cloud:
    config:
      name: web-ui
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-docker.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: web-ui
  cloud:
    config:
      name: web-ui
      failFast: true
      retry:
        maxAttempts: 20
      discovery:
        service-id: config
        enabled: true
#  level.root: debug
eureka:
  client:
    registerWithEureka: true
    fetchRegistry: true
    registryFetchIntervalSeconds: 5
    service-url:
      defaultZone: 'http://${REGISTRY_HOST}:${REGISTRY_PORT}/eureka/'</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>bootstrap-dev.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spring:
  application:
    name: web-ui
  cloud:
    config:
      name: web-ui
      fail-fast: true
      retry:
        max-attempts: 20
      discovery:
        service-id: config
        enabled: true
eureka:
  client:
    service-url:
      defaultZone: 'http://localhost:2001/eureka'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment</p>
</div>
<div class="paragraph">
<p>The above embedded configurations are the basic settings of the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it sets its service name</p>
</li>
<li>
<p>it sets the configuration name to use (which configuration file to retrieve)</p>
</li>
<li>
<p>it must set the registry service (example in bootstrap-docker.yml)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_sample_development_configuration_7">Sample development configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2200
operatorfabric:
  security:
    provider-url: http://localhost:89
    provider-realm: dev
    logout-url: ${operatorfabric.security.provider-url}/auth/realms/${operatorfabric.security.provider-realm}/protocol/openid-connect/logout?redirect_uri=http://localhost:2002/ui/
    oauth2:
      flow:
        mode: CODE
        provider: Opfab Keycloak
        delagate-url: ${operatorfabric.security.provider-url}/auth/realms/${operatorfabric.security.provider-realm}/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client
  feed:
    subscription:
      timeout: 600000
    card:
      time:
        display: BUSINESS
    timeline:
      domains:
        - "TR"
        - "J"
        - "7D"
        - "W"
        - "M"
        - "Y"
    notify: false
  archive:
    filters:
      page.size:
        - "10"
      page.first:
        - "0"
      publisher.list:
        - value: "TEST"
          label: "Test Publisher"
        - value: "TEST2"
          label: "Test Publisher 2"
      process.list:
            - process
            - someOtherProcess
      tags.list:
        - value: "tag1"
          label: "Label for tag 1"
        - value: "tag2"
          label: "Label for tag 2"
  i10n.supported.time-zones:
    - value: "Europe/Paris"
      label: "Headquarters timezone"
    - value: "Australia/Melbourne"
      label: "Down Under"
    - Europe/London
    - Europe/Dublin
    - Europe/Brussel
    - Europe/Berlin
    - Europe/Rome
    - Europe/Madrid
    - Europe/Lisbon
    - Europe/Amsterdam
    - Europe/Athens
    - Pacific/Samoa
  i18n.supported.locales:
    - en
    - fr
  settings:
    locale: en
    infos:
      description: true
    about:
      firstapplication:
        name: First application
        version: v12.34.56
        rank: 1
      keycloack:
        name: Keycloak
        version: 6.0.1
        rank: 2
      lastapplication:
          name: Wonderful Solution
          version: 0.1.2-RELEASE
  time:
    pulse: 5000</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sample_docker_image_configuration_8">Sample docker image configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>server:
  port: 2200
operatorfabric:
  security:
    provider-url: http://localhost:89
    provider-realm: dev
    logout-url: ${operatorfabric.security.provider-url}/auth/realms/${operatorfabric.security.provider-realm}/protocol/openid-connect/logout?redirect_uri=http://localhost:2002/ui/
    oauth2:
      flow:
        mode: CODE
        provider: Opfab Keycloak
        delagate-url: ${operatorfabric.security.provider-url}/auth/realms/${operatorfabric.security.provider-realm}/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client
  feed:
    subscription:
      timeout: 600000
    card:
      time:
        display: BUSINESS
    timeline:
      domains:
        - "TR"
        - "J"
        - "7D"
        - "W"
        - "M"
        - "Y"
    notify: false
  archive:
    filters:
      page.size:
        - "10"
      page.first:
        - "0"
      publisher.list:
        - value: "TEST"
          label: "Test Publisher"
        - value: "TEST2"
          label: "Test Publisher 2"
      process.list:
            - process
            - someOtherProcess
      tags.list:
        - value: "tag1"
          label: "Label for tag 1"
        - value: "tag2"
          label: "Label for tag 2"
  i10n.supported.time-zones:
    - value: "Europe/Paris"
      label: "Headquarters timezone"
    - value: "Australia/Melbourne"
      label: "Down Under"
    - Europe/London
    - Europe/Dublin
    - Europe/Brussel
    - Europe/Berlin
    - Europe/Rome
    - Europe/Madrid
    - Europe/Lisbon
    - Europe/Amsterdam
    - Europe/Athens
    - Pacific/Samoa
  i18n.supported.locales:
    - en
    - fr
  settings:
    locale: en
    infos:
      description: true
    about:
      firstapplication:
        name: First application
        version: v12.34.56
        rank: 1
      keycloack:
        name: Keycloak
        version: 6.0.1
        rank: 2
      lastapplication:
          name: Wonderful Solution
          version: 0.1.2-RELEASE
  time:
    pulse: 5000</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_external_configuration_properties_when_lauching_a_jar_file_4">Specifying external configuration properties when lauching a jar file</h5>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config-application-property-files">Application Property Files</a>
on how to setup an external spring properties or yml file.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#howto-set-active-spring-profiles">Set the Active Spring Profiles</a> for specifying alternate profile.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_a_docker_image_4">Specifying configuration properties when lauching a docker image</h5>
<div class="paragraph">
<p>Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.</p>
</div>
<div class="paragraph">
<p>At time of writing, you cannot specify an alternate profile at runCards-Publication.
The default profiles activated are docker and native.</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_for_docker_image_9">Available environment variables for docker image</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_configuration_properties_when_lauching_on_kubernetes_4">Specifying configuration properties when lauching on Kubernetes</h5>
<div class="paragraph">
<p>In progress</p>
</div>
<div class="sect5">
<h6 id="_available_environment_variables_when_launching_on_kubernetes_9">Available environment variables when launching on Kubernetes</h6>
<div class="ulist">
<ul>
<li>
<p>REGISTRY_HOST: Registry service host</p>
</li>
<li>
<p>REGISTRY_PORT: Registry service port</p>
</li>
<li>
<p>JAVA_OPTIONS: Additional java options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_groups_administration">11.5. Users and Groups Administration</h3>
<div class="paragraph">
<p>A new operator call John Doe, who has OAuth granted right to connect ot current <code>OperatorFabric</code> instance, need to receive cards within current <code>OperatorFabric</code> instance. As a user of OperatorFabric, he needs to be added to the system with a <code>login</code> (john-doe-operator), his <code>firstName</code> (John) and his <code>lastName</code> (Doe).
operator
As there is no <code>Administration GUI</code> for the moment, it must be performed through command line, as specify <a href="https://opfab.github.io/projects/services/core/users/1.0.0.RELEASE/api/#SimpleUser">here</a>.</p>
</div>
<div class="sect3">
<h4 id="_list_all_users">11.5.1. List all users</h4>
<div class="paragraph">
<p>First of all, list the users (who are the recipients in OperatorFabric) of the system with the following commands:</p>
</div>
<div class="paragraph">
<p>Httpie</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users "Authorization:Bearer $token" "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -v http://localhost:2103/users -H "Authorization:Bearer $token" -H "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

[
    {
        "firstName": null,
        "groups": [
            "ADMIN"
        ],
        "lastName": null,
        "login": "admin"
    },
    {
        "firstName": null,
        "groups": [
            "RTE",
            "ADMIN",
            "CORESO",
            "TRANS",
            "TEST"
        ],
        "lastName": null,
        "login": "rte-operator"
    },
    {
        "firstName": null,
        "groups": [
            "ELIA"
        ],
        "lastName": null,
        "login": "elia-operator"
    },
    {
        "firstName": null,
        "groups": [
            "CORESO"
        ],
        "lastName": null,
        "login": "coreso-operator"
    },
    {
        "firstName": null,
        "groups": [
            "TSO1",
            "TRANS",
            "TEST"
        ],
        "lastName": null,
        "login": "tso1-operator"
    },
    {
        "firstName": null,
        "groups": [
            "TSO2",
            "TRANS"
        ],
        "lastName": null,
        "login": "tso2-operator"
    },
]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_user">11.5.2. Create a new User</h4>
<div class="paragraph">
<p>We are sure that no John-doe-operator exists in our OperatorFabric instance. We can add him in our OperatorFabric instance using the following command use httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"login":"john-doe-operator","firstName":"Jahne","lastName":"Doe"}' | http POST http://localhost:2103/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>Or here cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/users -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"login":"john-doe-operator","firstName":"Jahne","lastName":"Doe"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "Jahne",
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_user_details">11.5.3. Fetch user details</h4>
<div class="paragraph">
<p>It&#8217;s always a good thing to verify if all the information has been correctly recorded in the system:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http -b http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "Jahne",
    "groups": [],
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_user_details">11.5.4. Update user details</h4>
<div class="paragraph">
<p>As shown by this result, the firstName of the new operator has been misspelled.We need <a href="https://opfab.github.io/projects/services/core/users/1.0.0.RELEASE/api/#updateUser">to update the existing user</a> with <code>john-doe-operator</code> login. To correct this mistake, the following commands can be used :</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"login":"john-doe-operator","lastName":"Doe","firstName":"John"}' | http PUT http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"login":"john-doe-operator","firstName":"John","lastName":"Doe"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_groups">11.5.5. List groups</h4>
<div class="paragraph">
<p>This operator is the first member of a new group operator called the <code>OPERATORS</code>, which doesn&#8217;t exist for the moment in the system. As shown when we <a href="https://opfab.github.io/projects/services/core/users/1.0.0.RELEASE/api/#fetchGroups">lists the groups existing in the server</a>.</p>
</div>
<div class="paragraph">
<p>Httpie</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/groups -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

[
    {
        "description": "The admin group",
        "name": "ADMIN"
    },
    {
        "description": "RTE TSO Group",
        "name": "RTE"
    },
    {
        "description": "ELIA TSO group",
        "name": "ELIA"
    },
    {
        "description": "CORESO Group",
        "name": "CORESO"
    },
    {
        "description": "TSO 1 Group",
        "name": "TSO1"
    },
    {
        "description": "TSO 2 Group",
        "name": "TSO2"
    },
    {
        "description": "Transnationnal Group",
        "name": "TRANS"
    }
]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_group">11.5.6. Create a new Group</h4>
<div class="paragraph">
<p>Firstly, the group called <code>OPERATORS</code> has <a href="https://opfab.github.io/projects/services/core/users/1.0.0.RELEASE/api/#createGroup">to be added to the system</a> using the following command:</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"name":"OPERATORS","decription":"This is the brand new  group of operator"}' | http POST http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/groups -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"name":"OPERATORS","decription":"This is the brand new  group of operator"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "description": null,
    "name": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_details_of_a_given_group">11.5.7. Fetch details of a given group</h4>
<div class="paragraph">
<p>The result return seems strange, to verify if it&#8217;s the correct answer by <a href="https://opfab.github.io/projects/services/core/users/1.0.0.RELEASE/api/#fetchGroup">displaying the details of the group</a> called <code>OPERATORS</code>, use the following command:</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups/OPERATORS "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/groups/OPERATORS -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "description": null,
    "name": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_details_of_a_group">11.5.8. Update details of a group</h4>
<div class="paragraph">
<p>The description is really null. After verification, in our first command used to create the group, the attribute for the description is misspelled. Using the following command <a href="https://opfab.github.io/projects/services/core/users/1.0.0.RELEASE/api/#updateGroup">to update the group</a>, with the correct spelling, the new group of operator gets a proper description:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"name":"OPERATORS","description":"This is the brand new  group of operator"}' | http -b PUT http://localhost:2103/groups/OPERATORS "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/groups/OPERATORS -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"name":"OPERATORS","description":"This is the brand new  group of operator"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "description": "This is the brand new  group of operator",
    "name": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_a_user_to_a_group">11.5.9. Add a user to a group</h4>
<div class="paragraph">
<p>As both new group and new user are correct it&#8217;s time <a href="https://opfab.github.io/projects/services/core/users/1.0.0.RELEASE/api/#addGroupUsers">to make the user member of the group</a>. To achieve this, use the following command:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '["john-doe-operator"]' | http PATCH http://localhost:2103/groups/OPERATORS/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PATCH http://localhost:2103/groups/OPERATORS/users -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '["john-doe-operator"]'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s verify that the changes are correctly recorded by fetching the :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "groups": ["OPERATORS"],
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s now possible to send cards either specifically to <code>john-doe-operator</code> or more generally to the <code>OPERATORS</code> group.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remove_a_user_from_a_group">11.5.10. Remove a user from a Group</h4>
<div class="paragraph">
<p>When John Doe is no longer in charge of hypervising cards for <code>OPERATORS</code> group, this group has to be removed from his login by using the following command:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http DELETE http://localhost:2103/groups/OPERATORS/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X DELETE -H "Authorization:Bearer $token" -H "Content-Type:application/json" http://localhost:2103/groups/OPERATORS/users/john-doe-operator</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
	"login":"john-doe-operator","
	firstName":"John",
	"lastName":"Doe",
	"groups":[]
}</pre>
</div>
</div>
<div class="paragraph">
<p>A last command to verify that <code>OPERATORS</code> is no longer linked to <code>john-doe-operator</code>:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "groups": [],
    "lastName": "Doe",
    "login": "coreso-operator"

}</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_port_table">12. Service port table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default all service built artifacts are configured with server.port set
to 8080</p>
</div>
<div class="paragraph">
<p>If you run the services using <code>bootRun</code> Gradle task or the provided
docker-compose files (see [prj]/src/main/docker) the ports used are</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-right valign-top">bootRun port</th>
<th class="tableblock halign-right valign-top">docker-compose mapping</th>
<th class="tableblock halign-right valign-top">docker-compose debug mapping</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">registry</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2001</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2001</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gateway</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2002</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2002</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2002</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thirds</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2101</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2101</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2101</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2102</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2103</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2104</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4000</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4000</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">registry</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4001</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4001</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gateway</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4002</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4002</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4002</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thirds</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4101</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4101</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4101</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4102</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4102</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4102</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4103</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4103</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p> <details><summary> 
<strong>Complete port table</strong>
 </summary><div> </p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Forwards to</th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KeyCloak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KeyCloak api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gateway</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gateway service http (REST+html)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thirds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Third party management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card publication service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card consultation service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actions (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-ui</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card consultation service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gateway</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thirds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-ui</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27017</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mongo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">27017</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mongo api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">amqp api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq api port</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restricted_operations_administration">13. Restricted operations (administration)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some operations are restricted to users with the <strong>ADMIN</strong> role, either because they are administration
operations with the potential to impact the OperatorFabric instance as a whole, or because they
give access to information that should be private to a user.</p>
</div>
<div class="paragraph">
<p>Below is a quick recap of these restricted operations.</p>
</div>
<div class="paragraph">
<div class="title">Users Service</div>
<p>Any action (read, create/update or delete) regarding a single user&#8217;s data (their personal info such as their first and
last name, as well as their settings) can be performed either by the user in question or by a user with the ADMIN role.</p>
</div>
<div class="paragraph">
<p>Any action on a list of users or on the groups (if authorization is managed in OperatorFabric) can only be performed by
a user with the ADMIN role.</p>
</div>
<div class="paragraph">
<div class="title">Thirds Service</div>
<p>Any write (create, update or delete) action on bundles can only be performed by a user with the ADMIN role. As such,
administrators are responsible for the quality and security of the provided bundles.
In particular, as it is possible to use scripts in templates, they should perform a security check to make sure that
there is no XSS risk.</p>
</div>
<div class="paragraph">
<div class="title">Time Service (for demonstration purposes only)</div>
<p>Any user can get the current state of simulated time but acting on it (changing the speed of time flow, setting
the reference for simulated time or resetting it entirely) requires the ADMIN role.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The ADMIN role doesn&#8217;t grant any special privileges when it comes to card consultation (be they current or
archived), so an user with the ADMIN role will only see cards that have been addressed to them or to one of their
groups), just like any other user.
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="_operatorfabric_community" class="sect0">OperatorFabric Community</h1>
<div class="sect1">
<h2 id="_introduction_3">14. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The aim of this document is to present the OperatorFabric community, its code of conduct and to welcome contributors!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing">15. Contributing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Thank you for your interest !</p>
</div>
<div class="paragraph">
<p>We can&#8217;t stress enough that feedback, discussions, questions and contributions on OperatorFabric are very much
appreciated.
However, because the project is still in its early stages, we&#8217;re not fully equipped for any of it yet, so please bear
with us while the contribution process and tooling are sorted out.</p>
</div>
<div class="sect2">
<h3 id="_code_of_conduct">15.1. Code of Conduct</h3>
<div class="paragraph">
<p>This project and everyone participating in it is governed by the <a href="CODE_OF_CONDUCT.adoc">OperatorFabric Code of Conduct</a>.
By participating, you are expected to uphold this code.
Please report unacceptable behavior to <a href="mailto:opfab_AT_lists.lfenergy.org">opfab_AT_lists.lfenergy.org</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_license_and_developer_certificate_of_origin">15.2. License and Developer Certificate of Origin</h3>
<div class="paragraph">
<p>OperatorFabric is an open source project licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License 2.0</a>.
By contributing to OperatorFabric, you accept and agree to the terms and conditions for your present and future
contributions submitted to OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The project also uses a mechanism known as a <a href="https://developercertificate.org/">Developer Certificate of Origin (DCO)</a>
to ensure that we are legally allowed to distribute all the code and assets for the project. A DCO is a legally binding
statement that asserts that you are the author of your contribution, and that you wish to allow OperatorFabric to use
your work.</p>
</div>
<div class="paragraph">
<p>Contributors sign-off that they adhere to these requirements by adding a <code>Signed-off-by</code> line to commit messages. All
commits to any repository of the OperatorFabric organization have to be signed-off like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>This is my commit message.

Signed-off-by: John Doe &lt;john.doe@email-provider.com&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You can write it manually but Git has a -s command line option to append it automatically to your commit message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git commit -s -m 'This is my commit message'</pre>
</div>
</div>
<div class="paragraph">
<p>Note that in the future a check will be performed during the integration, making sure all commits in the Pull Request
contain a valid <code>Signed-off-by</code> line.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_can_i_contribute">15.3. How Can I Contribute ?</h3>
<div class="paragraph">
<p>These processes and templates have been adapted from the ones defined by the <a href="https://github.com/powsybl">PowSyBl</a>
project.</p>
</div>
<div class="sect3">
<h4 id="_reporting_bugs_and_suggesting_enhancements">15.3.1. Reporting Bugs and Suggesting Enhancements</h4>
<div class="paragraph">
<p>Work in Progress</p>
</div>
</div>
<div class="sect3">
<h4 id="_contributing_code">15.3.2. Contributing Code</h4>
<div class="sect4">
<h5 id="_code_guidelines">Code Guidelines</h5>
<div class="ulist">
<ul>
<li>
<p>We don&#8217;t mention specific authors by name in each file (in Javadoc or in the
documentation for example), so has not to have to maintain these mentions (since this
information is tracked by git anyway).</p>
</li>
<li>
<p>If you are working on a JIRA issue:</p>
<div class="ulist">
<ul>
<li>
<p>Please name your branch with the corresponding JIRA issue ID: OC-XXX</p>
</li>
<li>
<p>Start all your commit messages with [OC-XXX]</p>
<div class="paragraph">
<p>This allows the branch, PR and commits to be directly accessible from the JIRA issue.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Before submitting your PR, please rebase your branch against the current master to minimize conflicts when merging.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>git checkout OC-XXX
git fetch
git rebase origin/master</code></pre>
</div>
</div>
</li>
<li>
<p>Before submitting your PR, please squash/fix your commits so as to reduce the
number of commits and comment them accordingly. In the end, the division of changes
into commits should make the PR easier to understand and review.</p>
</li>
<li>
<p>Feel free to add a copyright header (on top of the existing ones) to files
you create or amend. See src/main/headers for examples.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_contribution_process">Contribution Process</h5>
<div class="paragraph">
<p>Code Contribution is tracked as <a href="https://help.github.com/en/articles/about-pull-requests">GitHub Pull Requests</a>.
Crafting a good pull request takes time and energy and we will help as much as we can, but be prepared to follow our
iterative process. The iterative process has several goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maintain the quality of the project</p>
</li>
<li>
<p>Fix issues that are important to users</p>
</li>
<li>
<p>Allow everyone from the community to take part in the discussions, to reach the best possible solution</p>
</li>
<li>
<p>Make the review by OperatorFabric maintainers as efficient as possible</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please follow these steps to have your contribution considered by the maintainers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fill in all the required information in the <a href="PULL_REQUEST_TEMPLATE.adoc">template</a>.</p>
</li>
<li>
<p>Request a GitHub review by one of the core developers</p>
</li>
<li>
<p>Take their review into account or discuss the requested changes. Please don&#8217;t take criticism personally, it is normal
to iterate on this step several times.</p>
</li>
<li>
<p>Repeat step 3 until the pull request is merged!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Continuous integration is set up to run on all branches automatically and will often report problems, so don&#8217;t worry
about getting everything perfect on the first try (SonarCloud Analysis is a notorious problem source).
Until you add a reviewer, you can trigger as many builds as you want by amending your commits. The status checks
enforce the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All tests in the test suite pass</p>
</li>
<li>
<p>Checkstyle and SonarCloud report no violations (coming soon)</p>
</li>
<li>
<p>The code coverage is high enough (currently about 85%) (coming soon)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_governance">15.4. Project Governance</h3>
<div class="sect3">
<h4 id="_project_owner">15.4.1. Project Owner</h4>
<div class="paragraph">
<p>OperatorFabric is part of the <a href="https://www.lfenergy.org/">LF Energy Foundation</a>, a project of the
<a href="https://www.linuxfoundation.org/">Linux Foundation</a> that supports open source innovation projects within the energy
and electricity sectors.</p>
</div>
</div>
<div class="sect3">
<h4 id="_committers">15.4.2. Committers</h4>
<div class="paragraph">
<p>Committers are contributors who have made several valuable contributions to the project and are now relied upon to both
write code directly to the repository and screen the contributions of others. In many cases they are programmers but it
is also possible that they contribute in a different role. Typically, a committer will focus on a specific aspect of
the project, and will bring a level of expertise and understanding that earns them the respect of the community and the
project owner.</p>
</div>
</div>
<div class="sect3">
<h4 id="_technical_steering_committee">15.4.3. Technical Steering Committee</h4>
<div class="paragraph">
<p>The Technical Steering Committee (TSC) is composed of voting members elected by the active Committers as described in
the project’s Technical Charter.</p>
</div>
<div class="paragraph">
<p>OperatorFabric TSC voting members are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/0x62646f727465">Boris Dolley</a></p>
</li>
<li>
<p><a href="https://github.com/francoisjolain">François Jolain</a></p>
</li>
<li>
<p><a href="https://github.com/AlexGuironnetRTE">Alexandra Guironnet</a></p>
</li>
<li>
<p><a href="https://github.com/HanaeSafiRTE">Hanae Safi</a></p>
</li>
<li>
<p>Guillaume Trimbach</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Boris Dolley will chair the TSC, with Hanae Safi as his deputy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_contributors">15.4.4. Contributors</h4>
<div class="paragraph">
<p>Contributors include anyone in the technical community that contributes code, documentation, or other technical
artifacts to the project.</p>
</div>
<div class="paragraph">
<p>Anyone can become a contributor. There is no expectation of commitment to the project, no specific skill requirements
and no selection process. To become a contributor, a community member simply has to perform one or more actions that
are beneficial to the project.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_communication_channels">15.5. Communication channels</h3>
<div class="paragraph">
<p>In addition to GitHub we have set up:</p>
</div>
<div class="sect3">
<h4 id="_website_opfab_org">15.5.1. Website: <a href="http://opfab.org" class="bare">opfab.org</a></h4>
<div class="paragraph">
<p>Our website contains all the documentation and resources we&#8217;re currently working on. Here is what we aim to provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Architecture documentation</p>
</li>
<li>
<p>REST API documentation</p>
</li>
<li>
<p>Reference documentation for each component</p>
</li>
<li>
<p>Javadoc/Compodoc for each component</p>
</li>
<li>
<p>Tutorials and QuickStart guides and videos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>This documentation is our priority</strong> right now so future contributors can quickly find their way around the project.
Needless to say, it&#8217;s a work in progress so feel free to tell us what you feel is missing or what type of documentation
you would be interested in as a contributor.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We also use this website to broadcast any news we have about the project so don&#8217;t hesitate to subscribe to the
RSS feed on the home page to be informed of any update.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_spectrum_community_spectrum_chatopfab">15.5.2. Spectrum Community : <a href="https://spectrum.chat/opfab" class="bare">spectrum.chat/opfab</a></h4>
<div class="paragraph">
<p>If you would like to join the discussions regarding OperatorFabric, please
<a href="https://spectrum.chat/opfab">join our community on Spectrum</a>!</p>
</div>
<div class="paragraph">
<p>Regarding issue tracking, our Jira platform should be open soon.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lf_energy_mailing_lists">15.5.3. LF Energy Mailing Lists</h4>
<div class="paragraph">
<p>Several mailing lists have been created by LF Energy for the project, please feel free to subscribe to the ones you
could be interested in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://lists.lfenergy.org/g/opfab-announce">OperatorFabric Announcements</a> (such as new releases)</p>
</li>
<li>
<p><a href="https://lists.lfenergy.org/g/opfab">OperatorFabric General Discussion</a></p>
</li>
<li>
<p><a href="https://lists.lfenergy.org/g/opfab-dev">OperatorFabric Developers</a> for project development discussions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And if you&#8217;re interested in LF Energy in general:
<a href="https://lists.lfenergy.org/g/lfenergy">LF Energy General Discussion</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_jira">15.5.4. JIRA</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributor_covenant_code_of_conduct">16. Contributor Covenant Code of Conduct</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_our_pledge">16.1. Our Pledge</h3>
<div class="paragraph">
<p>In the interest of fostering an open and welcoming environment, we as
contributors and maintainers pledge to making participation in our project and
our community a harassment-free experience for everyone, regardless of age, body
size, disability, ethnicity, sex characteristics, gender identity and expression,
level of experience, education, socioeconomic status, nationality, personal
appearance, race, religion, or sexual identity and orientation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_our_standards">16.2. Our Standards</h3>
<div class="paragraph">
<p>Examples of behavior that contributes to creating a positive environment
include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using welcoming and inclusive language</p>
</li>
<li>
<p>Being respectful of differing viewpoints and experiences</p>
</li>
<li>
<p>Gracefully accepting constructive criticism</p>
</li>
<li>
<p>Focusing on what is best for the community</p>
</li>
<li>
<p>Showing empathy towards other community members</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of unacceptable behavior by participants include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The use of sexualized language or imagery and unwelcome sexual attention or
advances</p>
</li>
<li>
<p>Trolling, insulting/derogatory comments, and personal or political attacks</p>
</li>
<li>
<p>Public or private harassment</p>
</li>
<li>
<p>Publishing others' private information, such as a physical or electronic
address, without explicit permission</p>
</li>
<li>
<p>Other conduct which could reasonably be considered inappropriate in a
professional setting</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_our_responsibilities">16.3. Our Responsibilities</h3>
<div class="paragraph">
<p>Project maintainers are responsible for clarifying the standards of acceptable
behavior and are expected to take appropriate and fair corrective action in
response to any instances of unacceptable behavior.</p>
</div>
<div class="paragraph">
<p>Project maintainers have the right and responsibility to remove, edit, or
reject comments, commits, code, wiki edits, issues, and other contributions
that are not aligned to this Code of Conduct, or to ban temporarily or
permanently any contributor for other behaviors that they deem inappropriate,
threatening, offensive, or harmful.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scope">16.4. Scope</h3>
<div class="paragraph">
<p>This Code of Conduct applies both within project spaces and in public spaces
when an individual is representing the project or its community. Examples of
representing a project or community include using an official project e-mail
address, posting via an official social media account, or acting as an appointed
representative at an online or offline event. Representation of a project may be
further defined and clarified by project maintainers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enforcement">16.5. Enforcement</h3>
<div class="paragraph">
<p>Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported by contacting the project team at <a href="mailto:&#112;o&#119;&#x73;&#x79;&#x62;&#x6c;&#46;&#x64;&#x64;l&#64;&#x72;&#116;e&#45;&#102;&#114;a&#110;c&#x65;&#46;&#x63;&#x6f;&#109;">&#112;o&#119;&#x73;&#x79;&#x62;&#x6c;&#46;&#x64;&#x64;l&#64;&#x72;&#116;e&#45;&#102;&#114;a&#110;c&#x65;&#46;&#x63;&#x6f;&#109;</a>. All
complaints will be reviewed and investigated and will result in a response that
is deemed necessary and appropriate to the circumstances. The project team is
obligated to maintain confidentiality with regard to the reporter of an incident.
Further details of specific enforcement policies may be posted separately.</p>
</div>
<div class="paragraph">
<p>Project maintainers who do not follow or enforce the Code of Conduct in good
faith may face temporary or permanent repercussions as determined by other
members of the project&#8217;s leadership.</p>
</div>
</div>
<div class="sect2">
<h3 id="_attribution">16.6. Attribution</h3>
<div class="paragraph">
<p>This Code of Conduct is adapted from the <a href="https://www.contributor-covenant.org">Contributor Covenant</a>, version 1.4,
available at <a href="https://www.contributor-covenant.org/version/1/4/code-of-conduct.html">https://www.contributor-covenant.org/version/1/4/code-of-conduct.html</a></p>
</div>
<div class="paragraph">
<p>For answers to common questions about this code of conduct, see
<a href="https://www.contributor-covenant.org/faq">https://www.contributor-covenant.org/faq</a></p>
</div>
</div>
</div>
</div>
<h1 id="_operatorfabric_cicd" class="sect0">OperatorFabric CICD</h1>
<div class="sect1">
<h2 id="_introduction_4">17. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The aim of this document is to describe our CICD pipeline and our release process.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_release_process">18. Release process</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_version_numbers">18.1. Version numbers</h3>
<div class="paragraph">
<p>Version numbers X.Y.Z.label should be understood like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>X: Major version, a major version adds new features and breaks compatibility with previous major and minor versions.</p>
</li>
<li>
<p>Y: Minor version, a minor version adds new features and does not break compatibility with previous minor versions for
the same major version.</p>
</li>
<li>
<p>Z: Patch, a patch version only contains bug fixes of current minor version</p>
</li>
<li>
<p>Label: pre-release or build metadata:</p>
<div class="ulist">
<ul>
<li>
<p>SNAPSHOT: a version whose development is in progress, nightly builds only deliver SNAPSHOT versions</p>
</li>
<li>
<p>RELEASE: a version whose development is finished</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_releasing_version">18.2. Releasing Version</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To release a version we use some Travis dedicated jobs. These jobs are triggered by specific commit keywords and rely
on the VERSION file at the root of this repository to know which version is being produced.
It is thus crucial to double-check the content of this file before any push (triggering the Travis jobs) is made.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before releasing a version, you need to prepare the release.</p>
</div>
<div class="paragraph">
<p>Considering a version X.X.X.SNAPSHOT.</p>
</div>
<div class="sect3">
<h4 id="_in_the_source_repository_operatorfabric_core">18.2.1. In the source repository (operatorfabric-core)</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the ./CICD/prepare_release_version.sh script to automatically perform all the necessary changes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>./CICD/prepare_release_version.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will perform the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace X.X.X.SNAPSHOT with X.X.X.RELEASE in *.adoc, swagger.yaml files and the VERSION file at the root operator-fabric folder</p>
</li>
<li>
<p>Update the revision date in *.adoc files (by default, the new revision date is today, but see the script usage for details)</p>
</li>
<li>
<p>Change the version from W.W.W.RELEASE (previous release) to X.X.X.RELEASE in the deploy docker-compose file</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The VERSION file is particularly important as the CI/CD pipeline tasks
(building the documentation and the docker images for example) are based on it.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Commit with the template message:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[RELEASE] X.X.X.RELEASE (ci_docker,ci_documentation)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The commit comment leverages these three keywords to trigger the delivery of documentation and docker images, so you should
check that they are correctly spelt.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ci_docker: triggers the build and upload of versioned docker images to dockerhub</p>
</li>
<li>
<p>ci_documentation: triggers the build and upload of the current documentation</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tag the commit with the version</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>git tag X.X.X.RELEASE</code></pre>
</div>
</div>
</li>
<li>
<p>Push the commit</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>git push</code></pre>
</div>
</div>
</li>
<li>
<p>Push the tag</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>git push origin X.X.X.RELEASE</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the build is correctly triggered</p>
<div class="paragraph">
<p>You can check the status of the build job triggered by the commit on <a href="https://travis-ci.org/opfab/operatorfabric-core/branches">Travis CI</a>.
The build job should have the following three stages:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/running_build.png" alt="Running build status page screenshot">
</div>
</div>
<div class="paragraph">
<p>Wait for the build to complete (around 30 minutes).</p>
</div>
</li>
<li>
<p>Check that the X.X.X.RELEASE images have been generated and pushed to DockerHub.</p>
</li>
<li>
<p>Check that the latest images have been updated on DockerHub.</p>
</li>
<li>
<p>Check that the documentation has been generated and pushed to the GitHub pages website (check version and revision
date at the top of document)</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You won&#8217;t be able to access it from the homepage until you have <a href="#_in_the_documentation_repository_opfab_github_io">updated the _version.yml file</a> in the opfab.github.io
repository, so instead you can just type <a href="https://opfab.github.io/documentation/X.X.X.SNAPSHOT/developer_guide/" class="bare">opfab.github.io/documentation/X.X.X.SNAPSHOT/developer_guide/</a> in your browser.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check that the tag was correctly pushed to GitHub and is visible under the
<a href="https://github.com/opfab/operatorfabric-core/releases">releases page</a> for the repository.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_checking_deploy_docker_compose">18.2.2. Checking deploy docker-compose</h4>
<div class="paragraph">
<p>The deploy docker-compose file should always rely on the latest RELEASE version
available on DockerHub. Once the CI pipeline triggered by the previous steps has completed successfully,
and you can see X.X.X.RELEASE images for all services on DockerHub, you should:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove your locally built X.X.X.RELEASE images if any</p>
</li>
<li>
<p>Run each of the two docker-compose files to make sure they pull the images from DockerHub and behave as intended.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_in_the_documentation_repository_opfab_github_io">18.2.3. In the documentation repository (opfab.github.io)</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the _data/versions.yml file:</p>
<div class="ulist">
<ul>
<li>
<p>Change:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>- name: X.X.X
  fullname: X.X.X.SNAPSHOT
  badges:
  - name: SNAPSHOT
    style: badge-snapshot</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>- name: X.X.X
  fullname: X.X.X.RELEASE
  badges:
  - name: RELEASE
    style: badge-release
  - name: CURRENT
    style: badge-current</code></pre>
</div>
</div>
</li>
<li>
<p>Then remove the following lines from the previous release version:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  - name: CURRENT
    style: badge-current</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Commit and push changes</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_in_jira">18.2.4. In Jira</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set all concerned tickets (US, BUG, FR) and set fix version to X.X.X.RELEASE</p>
</li>
<li>
<p>In the "Releases" screen release X.X.X.RELEASE version</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advertising_the_new_release_opfab_github_io_and_mailing_list">18.3. Advertising the new release (opfab.github.io and mailing list)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the appropriate version from
<a href="https://opfab.atlassian.net/projects/OC?orderField=RANK&amp;selectedItem=com.atlassian.jira.jira-projects-plugin%3Arelease-page&amp;status=all">JIRA the release list</a>
to get the release notes (click "Release notes" under the version name at the top) listing new features, fixed bugs etc&#8230;&#8203;</p>
<div class="imageblock">
<div class="content">
<img src="./images/release_notes.png" alt="Release notes link">
</div>
</div>
</li>
<li>
<p>Take this text and use it
to create a short post on the opfab.github.io repository (under _posts) announcing the release.
This post should highlight new features and necessary upgrade actions if any.</p>
</li>
<li>
<p>Send the same content as an email to the <a href="mailto:opfab-announce@lists.lfenergy.org">opfab-announce@lists.lfenergy.org</a> mailing list.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_preparing_next_version">18.4. Preparing next version</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should wait for all the tasks associated with creating the X.X.X.RELEASE
version to finish and make sure that they&#8217;ve had the expected output before starting the
preparation of the next version. This is because any committed/pushed changes preparing the
new version will make rolling back or correcting any mistake on the release more complicated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To prepare a next version you simply need to increment the version after a release (see <a href="#_version_numbers">Version numbers</a>).</p>
</div>
<div class="sect3">
<h4 id="_in_the_source_repository_operatorfabric_core_2">18.4.1. In the source repository (operatorfabric-core)</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the ./CICD/prepare_snapshot_version.sh script to automatically perform all the necessary changes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>./CICD/prepare_snapshot_version.sh --version Y.Y.Y.SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will perform the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace all occurrences of X.X.X.RELEASE by Y.Y.Y.SNAPSHOT <strong>EXCEPT</strong> in the deploy docker-compose file
(src/main/docker/deploy/docker-compose.yml). The files concerned are *.adoc,
swagger.yaml files and the VERSION file at the root operatorfabric-core folder.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The VERSION file is particularly important as the CI/CD pipeline tasks
(building the documentation and the docker images for example) are based on it.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no --version parameter is provided to the script, the new version will be the next minor version.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add a Y.Y.Y.RELEASE.adoc file (blank except for copyright and title) under src/docs/asciidoc/release_notes to initialize the release
notes for next version.</p>
</li>
<li>
<p>Commit and push changes with the following message:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[PREPARE] next version: Y.Y.Y.SNAPSHOT</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_in_the_documentation_repository_opfab_github_io_2">18.4.2. In the documentation repository (opfab.github.io)</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the _data/versions.yml file, add the Y.Y.Y.SNAPSHOT version</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>- name: Y.Y.Y
  fullname: Y.Y.Y.SNAPSHOT
  badges:
  - name: SNAPSHOT
    style: badge-snapshot</code></pre>
</div>
</div>
</li>
<li>
<p>Commit and push changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_in_jira_2">18.4.3. In Jira</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the "Releases" screen create a  Y.Y.Y.RELEASE version.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_checking_dockerhub_the_following_day">18.4.4. Checking DockerHub the following day</h4>
<div class="paragraph">
<p>A CRON Travis job runs daily (the time of the day may vary) and generates the documentation and docker snapshot images.
After you have finished switching to the Y.Y.Y.SNAPSHOT version, you should wait for such a job to run and check that
the snapshot images are correctly generated and pushed on DockerHub.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cicd_scripts">19. CICD Scripts</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">CICD/prepare_release_version.sh</dt>
<dd>
<p>performs the changes necessary to tag a RELEASE version</p>
</dd>
<dt class="hdlist1">CICD/prepare_snapshot_version.sh</dt>
<dd>
<p>performs the changes necessary to tag a SNAPSHOT version</p>
</dd>
</dl>
</div>
</div>
</div>
<h1 id="_operatorfabric_release_notes" class="sect0">OperatorFabric Release Notes</h1>
<div class="sect1">
<h2 id="_version_1_0_0_release">20. Version 1.0.0.RELEASE</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_story">20.1. Story</h3>
<div class="ulist">
<ul>
<li>
<p>[OC-624] As a user I want to sort cards on the feed either by severity, lttd, publishDate or by lttd, publishDate only.</p>
<div class="paragraph">
<p><em>In the feed, the cards remain sorted by default by severity, then by lttd (last time to decide) desc.
(i.e. closest lttd first), then by publication date asc. (i.e. latest cards first).</em></p>
</div>
<div class="paragraph">
<p><em>This version adds a toggle to the feed buttons to switch to a second sort order that doesn&#8217;t take severity
into account, so that cards are sorted by closest lttd then latest publication date.</em></p>
</div>
<div class="paragraph">
<p><em>Note: No configuration is necessary.</em></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bug">20.2. Bug</h3>
<div class="ulist">
<ul>
<li>
<p>[OC-549] - Thirds API does&#8217;t return 404 when requested third doesn&#8217;t exist.</p>
</li>
<li>
<p>[OC-325] - Put a long heartbeat timeout to avoid losing cards</p>
</li>
<li>
<p>[OC-349] - Correct bug in token silent refresh (Implicit Mode)</p>
</li>
<li>
<p>[OC-715] - [Cards-consultation][tests] : clean must be done after each unit test</p>
</li>
<li>
<p>[OC-727] - regression in Action Service - feign.codec.DecodeException</p>
</li>
<li>
<p>[OC-368] - Cards with an end date that is before their start date should be refused</p>
</li>
<li>
<p>[OC-720] - CSS in card detail is not correctly applied until reload</p>
</li>
<li>
<p>[OC-604] - On first opening the app, the feed filter isn&#8217;t synchronized with timeline time horizon</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_task">20.3. Task</h3>
<div class="ulist">
<ul>
<li>
<p>[OC-669] Card publication service refactoring</p>
<div class="ulist">
<ul>
<li>
<p>Remove unused and non working recipient options : INTERSECT , RANDOM, WEIGHTED and FAVORITE</p>
</li>
<li>
<p>Remove unused field mainRecipient</p>
</li>
<li>
<p>Remove internal asynchronous mecanism to push cards in Mongo and Rabbit</p>
</li>
</ul>
</div>
</li>
<li>
<p>[OC-643] - Remove code regarding unused virtual time in frontend</p>
</li>
<li>
<p>[OC-687] - Remove unused OAuth2 micro-service</p>
</li>
<li>
<p>[OC-712] - When Token refresh is not possible redirect to login page (Implicit Mode)</p>
</li>
<li>
<p>[OC-724] - Adding an Endpoint for the logout process</p>
<div class="paragraph">
<p><em>To successfully destroy the current session user in Keycloak, you need to provide a <strong>logout-url</strong> as explained in the <a href="https://opfab.github.io/documentation/0.16.1.SNAPSHOT/user_guide/#_web_ui">doc</a></em></p>
</div>
</li>
<li>
<p>[OC-649] - Upgrade the backend</p>
</li>
<li>
<p>[OC-681] - Migrate angular from version 7 to 8</p>
<div class="paragraph">
<p><em>In this task, we moved to version 8 of Angular, we would draw your attention that there is a breaking changes during this migration, especially, we passed from v10.10.0 to v10.16.3 of node, and from 7 to 8 of ng command (angular-cli)</em>
<em>Please refer to angular.json file the packages we have migrated</em></p>
</div>
</li>
<li>
<p>[OC-652] - Update API Action documentation, more precisely, remove unused fields : lockCard, needsConfirm, updateState, contentStyle, inputs</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_feature">20.4. Feature</h3>
<div class="ulist">
<ul>
<li>
<p>[OC-204] - As a Client, I need a about section "about" with a fixed value and a freely configurable value</p>
<div class="ulist">
<ul>
<li>
<p>adds release version and application name into jar manifests;</p>
</li>
<li>
<p>displays current release version of <code>OperatorFabric</code> into the <code>UI about section</code>;</p>
</li>
<li>
<p>enables new settings into <code>web-ui.yml</code> of <code>config service</code> to be displayed in the <code>UI about section</code>, cf user guide - web-ui section for more details.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_version_0_15_1_release">21. Version 0.15.1.RELEASE</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bug_2">21.1. Bug</h3>
<div class="ulist">
<ul>
<li>
<p>[OC-458] - Fix/test docker-compose</p>
<div class="paragraph">
<p><em>The containers created by test-environment and test-quality-environment docker-compose now have default
docker-generated names rather than set names (e.g. <strong>test-environment_keycloak_1</strong> rather than <strong>keycloak</strong>). This is
done to avoid conflicts.</em></p>
</div>
</li>
<li>
<p>[OC-442] - Cards in the feed aren&#8217;t no longer sorted according to their arrival</p>
</li>
<li>
<p>[OC-487] - Feed empty or unresponsive when changing user</p>
</li>
<li>
<p>[OC-615] - Once logged if the user reload the UI the navbar alone is displayed</p>
<div class="paragraph">
<p><em>See configuration <a href="https://opfab.github.io/documentation/0.16.1.SNAPSHOT/user_guide/#_web_ui">doc</a> and  see <a href="https://opfab.github.io/documentation/0.16.1.SNAPSHOT/user_guide/#_operator_fabric_specific_configuration">doc</a>: add the relam name and keycloak server instance ip address to web-ui.json and application.yml</em></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_story_2">21.2. Story</h3>
<div class="ulist">
<ul>
<li>
<p>[OC-579] -Now, for each microservice DockerHub will offer the following tags:</p>
<div class="ulist">
<ul>
<li>
<p>snapshot: Current snapshot version as generated by the daily CRON travis job.</p>
</li>
<li>
<p>X.X.X.RELEASE: Image corresponding to the given release. Past releases are kept.</p>
</li>
<li>
<p>latest: Shortcut for the latest release.</p>
</li>
</ul>
</div>
</li>
<li>
<p>[OC-616] - Change severity names :</p>
<div class="ulist">
<ul>
<li>
<p>INFORMATION is replaced by NOTIFICATION</p>
</li>
<li>
<p>QUESTION is replaced by COMPLIANT</p>
<div class="paragraph">
<p>It is necessary to remove or modify card created with previous version in the mongoDB database for the sytem to work properly.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>[OC-618] - Add the possibility  to hide some fields in settings page</p>
<div class="paragraph">
<p><em>See the <strong>web-ui</strong> configuration doc from here:  <a href="https://opfab.github.io/documentation/0.16.1.SNAPSHOT/user_guide/#_web_ui">Service specific properties</a>. (All the properties starting with <strong>operatorfabric.settings.infos</strong>)</em></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_task_2">21.3. Task</h3>
<div class="ulist">
<ul>
<li>
<p>[OC-507] - CI/CD hooks should only be triggered on the master branch</p>
<div class="paragraph">
<p><em>No administration/user impact.</em></p>
</div>
</li>
<li>
<p>[OC-552] - Network and service names should be consistent in docker-compose files</p>
<div class="paragraph">
<p><em>Creating the <strong>opfabnet</strong> and <strong>operatorfabricnet</strong> networks is no longer required, docker-compose files now rely on
default docker-generated networks (such as <strong>deploy_default</strong>).</em></p>
</div>
</li>
<li>
<p>[OC-560] - Fix SEVERE warnings in doc generation</p>
<div class="paragraph">
<p><em>No administration/user impact.</em></p>
</div>
</li>
<li>
<p>[OC-585][OC-595][OC-600][OC-601] - Multiple security correction</p>
<div class="paragraph">
<p><em>No administration/user impact.</em></p>
</div>
</li>
<li>
<p>[OC-602] - Deprecated MongoClient constructor</p>
<div class="paragraph">
<p><em>Today we have only one MongoDB server. But if one day we have several servers then there can only be one login/password for all the servers.</em></p>
</div>
</li>
<li>
<p>[OC-611] - Create missing Unit Test for Implicit flow in the UI</p>
</li>
<li>
<p>[OC-612] - Document the dev keycloak configuration to test implicit flow authentication</p>
<div class="paragraph">
<p><em>See the <strong>web-ui</strong> configuration doc frome here: <a href="https://opfab.github.io/documentation/0.16.1.SNAPSHOT/user_guide/#_operator_fabric_specific_configuration">OperatorFabric User Guide</a></em></p>
</div>
</li>
<li>
<p>[OC-625] - Fix add_header script and update copyright headers</p>
<div class="paragraph">
<p><em>Note to contributors: Copyright headers are up to date as of today, please make sure to add headers to any new file
that you add.</em></p>
</div>
</li>
<li>
<p>[OC-630] - Delete demo docker-compose</p>
<div class="paragraph">
<p><em>The demo docker compose has been deprecated in favour of using the deploy docker-compose and the push_card_loop as
described in the <a href="https://github.com/opfab/operatorfabric-core#8-docker-demo">README</a>.</em></p>
</div>
</li>
<li>
<p>[OC-641] - Correct deprecated warning in build</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.0.RELEASE<br>
Last updated 2020-04-01 08:17:22 +0200
</div>
</div>
</body>
</html>